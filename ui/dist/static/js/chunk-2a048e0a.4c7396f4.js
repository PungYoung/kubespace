(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a048e0a"],{"52b6":function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("clusterbar",{attrs:{titleName:e.titleName,nameFunc:e.nameSearch,createFunc:e.openCreateFormDialog,createDisplay:"创建空间"}}),o("div",{ref:"tableCot",staticClass:"dashboard-container"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.workspaces,"tooltip-effect":"dark","max-height":e.maxHeight,"cell-style":e.cellStyle,"default-sort":{prop:"name"},"row-key":"name"}},[o("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":"","min-width":"20"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"name-class",on:{click:function(o){return e.nameClick(t.row.id)}}},[e._v(" "+e._s(t.row.name)+" ")])]}}])}),o("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":"","min-width":"40"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("code"==t.row.type?t.row.code_url:t.row.description)+" ")]}}])}),o("el-table-column",{attrs:{prop:"update_user",label:"操作人","min-width":"20","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"update_time",label:"更新时间","min-width":"20","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$dateFormat(t.row.update_time))+" ")]}}])}),o("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"tableOperate"},[o("el-link",{staticStyle:{"margin-right":"15px",color:"#409EFF"},attrs:{underline:!1},on:{click:function(o){return e.nameClick(t.row.id)}}},[e._v("流水线")]),o("el-link",{staticStyle:{"margin-right":"15px",color:"#409EFF"},attrs:{underline:!1},on:{click:function(o){return e.openUpdateFormDialog(t.row)}}},[e._v("编辑")]),o("el-link",{staticStyle:{color:"#F56C6C"},attrs:{underline:!1},on:{click:function(o){return e.handleDeleteWorkspace(t.row.id,t.row.name)}}},[e._v("删除")])],1)]}}])})],1),o("el-dialog",{attrs:{title:e.updateFormVisible?"修改流水线空间":"创建流水线空间",visible:e.createFormVisible,"destroy-on-close":!0},on:{"update:visible":function(t){e.createFormVisible=t},close:e.closeFormDialog}},[o("div",{staticClass:"dialogContent"},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"left","label-width":"105px"}},[o("el-form-item",{attrs:{label:"空间类型",prop:"type"}},[e.updateFormVisible?o("span",[e._v(e._s(e.workspaceTypeMap[e.form.type]))]):o("el-radio-group",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[o("el-radio",{attrs:{label:"code"}},[e._v("代码空间")]),o("el-radio",{attrs:{label:"custom"}},[e._v("自定义空间")])],1)],1),"code"==e.form.type?o("el-form-item",{attrs:{label:"代码类型",prop:"codeType"},on:{change:e.codeTypeChange}},[o("el-radio-group",{on:{change:e.codeTypeChange},model:{value:e.form.codeType,callback:function(t){e.$set(e.form,"codeType",t)},expression:"form.codeType"}},[o("el-radio",{attrs:{label:"https"}},[e._v("HTTPS")]),o("el-radio",{attrs:{label:"git"}},[e._v("GIT")])],1)],1):e._e(),"code"==e.form.type?o("el-form-item",{attrs:{label:"代码地址",prop:"codeUrl"}},[o("el-input",{attrs:{autocomplete:"off",placeholder:"https"==e.form.codeType?"请输入代码地址，如: https://github.com/kubespace/kubespace.git":"请输入代码地址，如: git@github.com:kubespace/kubespace.git",size:"small"},model:{value:e.form.codeUrl,callback:function(t){e.$set(e.form,"codeUrl",t)},expression:"form.codeUrl"}})],1):e._e(),"code"==e.form.type?o("el-form-item",{attrs:{label:"访问密钥",prop:"codeSecretId"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择代码访问密钥",size:"small"},model:{value:e.form.codeSecretId,callback:function(t){e.$set(e.form,"codeSecretId",t)},expression:"form.codeSecretId"}},e._l("https"==e.form.codeType?e.codePasswordSecrets:e.codeKeySecrets,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),"custom"==e.form.type?o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{attrs:{autocomplete:"off",placeholder:"请输入空间名称",size:"small"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e(),"custom"==e.form.type?o("el-form-item",{attrs:{label:"描述",prop:"description"}},[o("el-input",{attrs:{type:"textarea",autocomplete:"off",placeholder:"请输入空间描述",size:"small"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1):e._e()],1)],1),o("div",{staticClass:"dialogFooter",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{"margin-right":"20px"},on:{click:function(t){e.createFormVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updateFormVisible?e.handleUpdateWorkspace():e.handleCreateWorkspace()}}},[e._v("确 定")])],1)])],1)],1)},a=[],c=(o("a4d3"),o("e01a"),o("b0c0"),o("b85c")),n=o("61b2"),i=o("6895"),s=o("f7ec"),l=o("5c96"),d={name:"PipelineWorkspace",components:{Clusterbar:n["a"]},data:function(){return{titleName:["流水线空间"],search_name:"",users:[],cellStyle:{border:0},maxHeight:window.innerHeight-150,loading:!0,workspaces:[],secrets:[],createFormVisible:!1,updateFormVisible:!1,form:{name:"",type:"code",codeType:"https",codeUrl:"",codeSecretId:""},workspaceTypeMap:{code:"代码空间",custom:"自定义空间"},codeTypeMap:{https:"HTTPS",git:"GIT"},rules:{name:[{required:!0,message:"请输入空间名称",trigger:"blur"}],type:[{required:!0,message:"请选择空间类型",trigger:"blur"}],codeType:[{required:!0,message:"",trigger:"blur"}],codeUrl:[{required:!0,message:" ",trigger:"blur"}],codeSecretId:[{required:!0,message:" ",trigger:"blur"}]}}},created:function(){this.fetchWorkspaces()},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-150;console.log(t),e.maxHeight=t}()}},computed:{codePasswordSecrets:function(){var e,t=[],o=Object(c["a"])(this.secrets);try{for(o.s();!(e=o.n()).done;){var r=e.value;"password"==r.type&&t.push(r)}}catch(a){o.e(a)}finally{o.f()}return t},codeKeySecrets:function(){var e,t=[],o=Object(c["a"])(this.secrets);try{for(o.s();!(e=o.n()).done;){var r=e.value;"key"==r.type&&t.push(r)}}catch(a){o.e(a)}finally{o.f()}return t}},methods:{fetchWorkspaces:function(){var e=this;this.loading=!0,Object(i["d"])().then((function(t){e.loading=!1,e.workspaces=t.data||[]})).catch((function(){e.loading=!1}))},fetchSecrets:function(){var e=this;Object(s["c"])().then((function(t){e.secrets=t.data?t.data:[]})).catch((function(e){console.log(e)}))},nameClick:function(e){this.$router.push({name:"pipeline",params:{workspaceId:e}})},nameSearch:function(e){this.search_name=e},handleCreateWorkspace:function(){var e=this;if(this.form.type){var t={type:this.form.type};if("code"==this.form.type){if(!this.form.codeUrl)return void l["Message"].error("代码地址不能为空");t["code_url"]=this.form.codeUrl,t["code_type"]=this.form.codeType,t["code_secret_id"]=this.form.codeSecretId}else{if(!this.form.name)return void l["Message"].error("流水线空间名称不能为空");t["name"]=this.form.name,t["description"]=this.form.description}Object(i["a"])(t).then((function(){e.createFormVisible=!1,l["Message"].success("创建流水线空间成功"),e.fetchWorkspaces()})).catch((function(e){console.log(e)}))}else l["Message"].error("请选择流水线空间类型")},handelUpdateWorkspace:function(){},handleDeleteWorkspace:function(e,t){var o=this;e?this.$confirm("请确认是否删除「".concat(t,"」此流水线空间?同时会删除该空间下的所有流水线。"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["b"])(e).then((function(){l["Message"].success("删除流水线空间成功"),o.fetchWorkspaces()})).catch((function(e){console.log(e)}))})).catch((function(){})):l["Message"].error("获取空间id参数异常，请刷新重试")},openCreateFormDialog:function(){this.form={name:"",type:"code",codeType:"https",codeUrl:"",codeSecretId:""},this.createFormVisible=!0,this.fetchSecrets()},openUpdateFormDialog:function(e){this.form={name:e.name,type:e.type,codeType:e.code_type,codeUrl:e.code_url,codeSecretId:e.code_secret_id},this.updateFormVisible=!0,this.createFormVisible=!0,this.fetchSecrets()},closeFormDialog:function(){this.updateFormVisible=!1,this.createFormVisible=!1},codeTypeChange:function(){this.form.codeUrl="",this.form.codeSecretId=""}}},u=d,p=(o("9f61"),o("2877")),m=Object(p["a"])(u,r,a,!1,null,"25640892",null);t["default"]=m.exports},"755b":function(e,t,o){},"9f61":function(e,t,o){"use strict";var r=o("755b"),a=o.n(r);a.a},f7ec:function(e,t,o){"use strict";o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return c})),o.d(t,"d",(function(){return n})),o.d(t,"b",(function(){return i}));var r=o("b775");function a(){return Object(r["a"])({url:"/settings/secret",method:"get"})}function c(e){return Object(r["a"])({url:"/settings/secret",method:"post",data:e})}function n(e,t){return Object(r["a"])({url:"/settings/secret/".concat(e),method:"put",data:t})}function i(e){return Object(r["a"])({url:"/settings/secret/".concat(e),method:"delete"})}}}]);