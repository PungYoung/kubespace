(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ac8d5a48"],{"2a40":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("clusterbar",{attrs:{titleName:e.titleName,createFunc:e.openImportAppVersionDialog,createDisplay:"导入新版本",titleLink:["appstoreIndex"]}}),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container"},[a("el-card",{staticClass:"appVersionCard",attrs:{shadow:""}},[a("el-row",[a("el-col",{staticStyle:{width:"80px"},attrs:{span:4}},[a("div",{staticClass:"app-version-img-wrapper",staticStyle:{"margin-left":"10px"}},[a("el-image",{attrs:{src:e.originApp.icon?"data:image/png;base64,"+e.originApp.icon:"",fit:"contain"}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[a("span",{staticStyle:{"font-size":"32px"}},[a("i",{staticClass:"el-icon-s-grid"})])])])],1)]),a("el-col",{attrs:{span:18}},[a("div",{staticStyle:{"font-size":"18px","margin-top":"4px"}},[e._v(" "+e._s(e.originApp.name)+" ")]),a("div",{staticStyle:{"margin-top":"2px"}},[a("span",{staticStyle:{"font-size":"13px",color:"#636a6e!important"}},[e._v("应用类型: ")]),a("span",{staticStyle:{"font-size":"14px"}},[e._v(e._s(e.typeMap[e.originApp.type]))])])])],1),a("el-row",[a("el-col",{staticClass:"description",attrs:{span:24}},[a("span",[e._v(" "+e._s(e.originApp.description)+" ")])])],1)],1),a("el-card",{staticClass:"appVersionTable"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.originApp.versions?e.originApp.versions:[],"cell-style":e.cellStyle,"default-sort":{prop:"create_time",order:"descending"},"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"name",label:"chart版本","show-overflow-tooltip":"","min-width":"15"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.package_version)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"app_version",label:"app版本","show-overflow-tooltip":"","min-width":"15"}}),a("el-table-column",{attrs:{prop:"description",label:"版本说明","show-overflow-tooltip":"","min-width":"15"}}),a("el-table-column",{attrs:{prop:"owner",label:"创建人","show-overflow-tooltip":"","min-width":"10"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.create_user)+" ")]}}])}),a("el-table-column",{attrs:{prop:"update_time",label:"创建时间","show-overflow-tooltip":"","min-width":"15"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$dateFormat(t.row.create_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"tableOperate"},[a("el-link",{staticStyle:{"margin-right":"13px",color:"#409EFF"},attrs:{underline:!1,type:"primary",href:"/app/charts/"+t.row.chart_path}},[e._v("下载")]),a("el-link",{attrs:{disabled:!e.$editorRole(),underline:!1,type:"danger"},on:{click:function(a){return e.handleDeleteVersion(t.row.id,t.row.package_version)}}},[e._v("删除")])],1)]}}])})],1)],1)],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],attrs:{title:"导入新版本",visible:e.createFormVisible,top:"5vh",width:"70%","destroy-on-close":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.createFormVisible=t},close:e.closeImportAppDialog}},[a("div",{staticClass:"dialogContent"},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"left","label-width":"105px"}},[e.form.name?a("el-form-item",{staticStyle:{"margin-top":"-10px"},attrs:{label:"应用名称",prop:"",required:""}},[e._v(" "+e._s(e.form.name)+" ")]):e._e(),a("el-form-item",{attrs:{label:"charts包",prop:"",required:""}},[a("el-upload",{ref:"appUpload",staticClass:"appStoreUpload",attrs:{drag:"",limit:1,data:e.form,"on-success":e.fileResolve,action:"/api/v1/appstore/resolve"}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将charts包文件拖到此处，或"),a("em",[e._v("点击上传")])])]),e.resolveErrMsg?a("span",{staticStyle:{"line-height":"20px"}},[e._v(e._s(e.resolveErrMsg))]):e._e()],1),e.form.package_version?a("el-form-item",{staticStyle:{"margin-top":"-10px"},attrs:{label:"chart版本",prop:"",required:""}},[e._v(" "+e._s(e.form.package_version)+" ")]):e._e(),e.form.package_version?a("el-form-item",{staticStyle:{"margin-top":"-10px"},attrs:{label:"app版本",prop:"",required:""}},[e._v(" "+e._s(e.form.app_version)+" ")]):e._e(),e.form.package_version?a("el-form-item",{staticStyle:{"margin-top":"-5px"},attrs:{label:"版本说明",prop:"",required:""}},[a("el-input",{attrs:{type:"textarea",autocomplete:"off",placeholder:"请输入应用版本说明",size:"small"},model:{value:e.form.version_description,callback:function(t){e.$set(e.form,"version_description",t)},expression:"form.version_description"}})],1):e._e()],1)],1),a("div",{staticClass:"dialogFooter",staticStyle:{"margin-top":"-10px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},on:{click:function(t){e.createFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleImportApp}},[e._v("导 入")])],1)])],1)},o=[],r=(a("b0c0"),a("61b2")),n=a("4bff"),s=a("5c96"),l=(a("e2c1"),{name:"AppStoreVersions",components:{Clusterbar:r["a"],Yaml:r["g"]},data:function(){return{cellStyle:{border:0},titleName:["应用商店"],maxHeight:window.innerHeight-135,loading:!0,dialogLoading:!1,originApp:{},typeMap:{middleware:"中间件",component:"集群组件",ordinary_app:"普通应用"},createFormVisible:!1,resolveErrMsg:"",form:{},rules:{}}},created:function(){this.fetchData()},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-135;e.maxHeight=t}()}},watch:{},computed:{appId:function(){return this.$route.params.appId}},methods:{fetchData:function(){var e=this;this.loading=!0,Object(n["c"])(this.appId,{with_versions:!0}).then((function(t){e.loading=!1,e.originApp=t.data,e.titleName=["应用商店",e.originApp.name]})).catch((function(){e.loading=!1}))},importAppVersion:function(){},handleDeleteVersion:function(e,t){var a=this;if(e){var i="请确认是否删除「".concat(t,"」此应用版本?");1==this.originApp.versions.length&&(i+=" 当前为最后一个版本，并同时删除该应用。"),this.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0,Object(n["b"])(a.appId,e).then((function(){s["Message"].success("删除应用版本成功"),1==a.originApp.versions.length?(a.loading=!1,a.$router.push({name:"appstoreIndex"})):a.fetchData()})).catch((function(e){console.log(e)}))})).catch((function(){}))}else s["Message"].error("获取应用版本id参数异常，请刷新重试")},handleImportApp:function(){var e=this,t=this.$refs.appUpload;if(0!=t.uploadFiles.length)if(this.form.name)if(this.form.version_description){var a=new FormData;a.append("file",t.uploadFiles[0].raw),a.append("name",this.form.name),a.append("package_version",this.form.package_version),a.append("app_version",this.form.app_version),a.append("version_description",this.form.version_description),this.dialogLoading=!0,Object(n["a"])(a).then((function(t){e.dialogLoading=!1,s["Message"].success("导入应用新版本成功"),e.createFormVisible=!1,e.fetchData()})).catch((function(){e.dialogLoading=!1}))}else s["Message"].error("请输入应用版本说明");else s["Message"].error("应用名称为空");else s["Message"].error("请上传charts包")},fileResolve:function(e,t,a){if(this.resolveErrMsg="","Success"!=e.code)t.status="error",this.resolveErrMsg=e.msg,s["Message"].error(e.msg),this.$refs.appUpload.clearFiles();else{var i=e.data;this.form={name:this.originApp.name,package_version:i.package_version,app_version:i.app_version,version_description:""}}},openImportAppVersionDialog:function(){this.form={name:this.originApp.name},this.createFormVisible=!0},closeImportAppDialog:function(){this.form={},this.resolveErrMsg=""}}}),p=l,c=(a("de30"),a("a3cc"),a("2877")),d=Object(c["a"])(p,i,o,!1,null,"ba27ffbc",null);t["default"]=d.exports},3337:function(e,t,a){},"4bff":function(e,t,a){"use strict";a.d(t,"d",(function(){return o})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s}));a("99af");var i=a("b775");function o(e){return Object(i["a"])({url:"appstore",method:"get",params:e})}function r(e,t){return Object(i["a"])({url:"appstore/".concat(e),method:"get",params:t})}function n(e){return Object(i["a"])({url:"appstore/create",method:"post",data:e})}function s(e,t){return Object(i["a"])({url:"appstore/".concat(e,"/").concat(t),method:"delete"})}},"88bb":function(e,t,a){},a3cc:function(e,t,a){"use strict";var i=a("88bb"),o=a.n(i);o.a},de30:function(e,t,a){"use strict";var i=a("3337"),o=a.n(i);o.a}}]);