(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ca1f7734"],{"4d75":function(e,a,t){"use strict";var s=t("ee83"),n=t.n(s);n.a},"97f0":function(e,a,t){"use strict";var s=t("c971"),n=t.n(s);n.a},a15b:function(e,a,t){"use strict";var s=t("23e7"),n=t("44ad"),l=t("fc6a"),o=t("a640"),r=[].join,i=n!=Object,c=o("join",",");s({target:"Array",proto:!0,forced:i||!c},{join:function(e){return r.call(l(this),void 0===e?",":e)}})},b562:function(e,a,t){"use strict";t.d(a,"d",(function(){return n})),t.d(a,"e",(function(){return l})),t.d(a,"c",(function(){return o})),t.d(a,"a",(function(){return r})),t.d(a,"b",(function(){return i}));var s=t("b775");function n(e,a){return Object(s["a"])({url:"helm/release/".concat(e,"/get"),method:"get",params:a})}function l(){return Object(s["a"])({url:"helm/app/list",method:"get"})}function o(e,a){return Object(s["a"])({url:"helm/app/get",method:"get",params:{name:e,chart_version:a}})}function r(e,a){return Object(s["a"])({url:"helm/release/".concat(e),method:"post",data:a})}function i(e,a){return Object(s["a"])({url:"helm/release/".concat(e),method:"delete",params:a})}},c971:function(e,a,t){},eab9:function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("clusterbar",{attrs:{titleName:e.titleName}}),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container"},[t("div",{staticStyle:{padding:"10px 8px 0px"}},[t("div",[e._v("基本信息")]),t("el-form",{staticClass:"pod-item",staticStyle:{margin:"15px 10px 20px 10px"},attrs:{"label-position":"left","label-width":"120px"}},[t("el-form-item",{attrs:{label:"名称"}},[t("span",[e._v(e._s(e.appDetail.name))])]),t("el-form-item",{attrs:{label:"命名空间"}},[t("span",[e._v(e._s(e.appDetail.namespace))])]),t("el-form-item",{attrs:{label:"Chart"}},[t("span",[e._v(e._s(e.appDetail.chart_name))])]),t("el-form-item",{attrs:{label:"应用版本"}},[t("span",[e._v(e._s(e.appDetail.app_version))])]),t("el-form-item",{attrs:{label:"上次部署"}},[t("span",[e._v(e._s(e.dateFormat(e.appDetail.last_deployed)))])])],1)],1),e.appResources["Ingress"]?t("div",{staticStyle:{padding:"0px 8px 0px"}},[t("div",[e._v("Ingress")]),t("div",{staticClass:"msgClass",staticStyle:{margin:"15px 10px 20px 10px"}},[t("el-table",{ref:"table",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.appResources["Ingress"],"tooltip-effect":"dark","cell-style":e.cellStyle,"default-sort":{prop:"metadata.name"}}},[t("el-table-column",{attrs:{prop:"metadata.name",label:"名称","min-width":"20","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[[t("span",{staticClass:"name-class",on:{click:function(t){return e.nameClick(a.row.kind,a.row.metadata.name)}}},[e._v(" "+e._s(a.row.metadata.name)+" ")])]]}}],null,!1,1237959523)}),t("el-table-column",{attrs:{prop:"restarts",label:"域名","min-width":"45","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.spec.rules,(function(a){return t("span",{key:a.host,staticClass:"back-class"},[e._v(" "+e._s(a.host)+" ")])}))}}],null,!1,3328280385)})],1)],1)]):e._e(),e.appResources["Service"]?t("div",{staticStyle:{padding:"0px 8px 0px"}},[t("div",[e._v("Service")]),t("div",{staticClass:"msgClass",staticStyle:{margin:"15px 10px 15px 10px"}},[t("el-table",{ref:"table",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.appResources["Service"],"tooltip-effect":"dark","cell-style":e.cellStyle,"default-sort":{prop:"metadata.name"}}},[t("el-table-column",{attrs:{prop:"metadata.name",label:"名称","min-width":"24","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[[t("span",{staticClass:"name-class",on:{click:function(t){return e.nameClick(a.row.kind,a.row.metadata.name)}}},[e._v(" "+e._s(a.row.metadata.name)+" ")])]]}}],null,!1,1237959523)}),t("el-table-column",{attrs:{prop:"type",label:"类型","min-width":"10","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(a.row.spec.type||"ClusterIP")+" ")])]}}],null,!1,4253077222)}),t("el-table-column",{attrs:{prop:"ports",label:"端口","min-width":"13","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.getPortsDisplay(a.row.spec.ports)))])]}}],null,!1,3124760704)}),t("el-table-column",{attrs:{prop:"selector",label:"选择器","min-width":"55","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.spec.selector?e._l(a.row.spec.selector,(function(a,s){return t("span",{key:s,staticClass:"back-class"},[e._v(" "+e._s(s+"="+a)+" ")])})):e._e()]}}],null,!1,2937269984)})],1)],1)]):e._e(),e.appResources["Deployment"]||e.appResources["StatefulSet"]||e.appResources["DaemonSet"]||e.appResources["CronJob"]||e.appResources["Job"]?[t("el-tabs",{staticStyle:{padding:"0px 8px 0px"},attrs:{value:e.defaultWorkloadName}},[e._l(["Deployment","StatefulSet","DaemonSet","CronJob","Job"],(function(a){return[e.appResources[a]?t("el-tab-pane",{key:a,attrs:{label:a,name:a}},[t("div",{staticClass:"msgClass"},[t("el-table",{ref:"table",refInFor:!0,staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.appResources[a],"tooltip-effect":"dark","cell-style":e.cellStyle,"default-sort":{prop:"metadata.name"}}},[t("el-table-column",{attrs:{prop:"metadata.name",label:"名称","min-width":"28","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[[t("span",{staticClass:"name-class",on:{click:function(t){return e.nameClick(a.row.kind,a.row.metadata.name)}}},[e._v(" "+e._s(a.row.metadata.name)+" ")])]]}}],null,!0)}),"CronJob"!=a&&"DaemonSet"!=a?t("el-table-column",{attrs:{prop:"type",label:"副本","min-width":"10","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(a.row.spec.replicas||1)+" ")])]}}],null,!0)}):e._e(),"CronJob"==a?t("el-table-column",{attrs:{prop:"type",label:"定时","min-width":"10","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(a.row.spec.schedule)+" ")])]}}],null,!0)}):e._e(),t("el-table-column","CronJob"!=a?{attrs:{prop:"selector",label:"POD选择器","min-width":"75","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.spec.selector.matchLabels?e._l(a.row.spec.selector.matchLabels,(function(a,s){return t("span",{key:s,staticClass:"back-class"},[e._v(" "+e._s(s+"="+a)+" ")])})):e._e()]}}],null,!0)}:{attrs:{prop:"selector",label:"POD选择器","min-width":"75","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.spec.jobTemplate.spec.selector.matchLabels?e._l(a.row.spec.jobTemplate.spec.selector.matchLabels,(function(a,s){return t("span",{key:s,staticClass:"back-class"},[e._v(" "+e._s(s+"="+a)+" ")])})):e._e()]}}],null,!0)})],1)],1)]):e._e()]}))],2)]:e._e(),e.appResources["ConfigMap"]||e.appResources["Secret"]?[t("el-tabs",{staticStyle:{padding:"0px 8px 0px"},attrs:{value:"ConfigMap"}},[e._l(["ConfigMap","Secret"],(function(a){return[e.appResources[a]?t("el-tab-pane",{key:a,attrs:{label:a,name:a}},[t("div",{staticClass:"msgClass"},[t("el-table",{ref:"table",refInFor:!0,staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.appResources[a],"tooltip-effect":"dark","cell-style":e.cellStyle,"default-sort":{prop:"metadata.name"}}},[t("el-table-column",{attrs:{prop:"metadata.name",label:"名称","min-width":"24","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[[t("span",{staticClass:"name-class",on:{click:function(t){return e.nameClick(a.row.kind,a.row.metadata.name)}}},[e._v(" "+e._s(a.row.metadata.name)+" ")])]]}}],null,!0)}),t("el-table-column",{attrs:{prop:"type",label:"Keys","min-width":"44","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.data,(function(a,s){return t("span",{key:s,staticClass:"back-class"},[e._v(" "+e._s(s)+" ")])}))}}],null,!0)})],1)],1)]):e._e()]}))],2)]:e._e(),e.appResources["PersistentVolumeClaim"]||e.appResources["PersistentVolume"]?[t("el-tabs",{staticStyle:{padding:"0px 8px 0px"},attrs:{value:"PersistentVolumeClaim"}},[e._l(["PersistentVolumeClaim","PersistentVolume"],(function(a){return[e.appResources[a]?t("el-tab-pane",{key:a,attrs:{label:a,name:a}},[t("div",{staticClass:"msgClass"},[t("el-table",{ref:"table",refInFor:!0,staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.appResources[a],"tooltip-effect":"dark","cell-style":e.cellStyle,"default-sort":{prop:"metadata.name"}}},[t("el-table-column",{attrs:{prop:"metadata.name",label:"名称","min-width":"34","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[[t("span",{staticClass:"name-class",on:{click:function(t){return e.nameClick(a.row.kind,a.row.metadata.name)}}},[e._v(" "+e._s(a.row.metadata.name)+" ")])]]}}],null,!0)}),t("el-table-column",{attrs:{prop:"type",label:"容量","min-width":"44","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(a.row.spec.resources.requests)+" ")])]}}],null,!0)}),t("el-table-column",{attrs:{prop:"type",label:"访问模式","min-width":"44","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(a.row.spec.accessModes)+" ")])]}}],null,!0)})],1)],1)]):e._e()]}))],2)]:e._e()],2),t("el-dialog",{attrs:{title:"升级",visible:e.yamlDialog,"close-on-click-modal":!1,width:"60%",top:"45px"},on:{"update:visible":function(a){e.yamlDialog=a},close:function(a){e.yamlDialog=!1,e.updateValues={name:"",namespace:"",config:"",values:""},e.yamlChange=1}}},[t("el-button-group",{staticStyle:{"margin-bottom":"10px"}},[t("el-button",{attrs:{type:e.yamlChange?"primary":"",size:"small"},on:{click:function(a){e.yamlChange=1}}},[e._v("当前配置")]),t("el-button",{attrs:{type:e.yamlChange?"":"primary",size:"small"},on:{click:function(a){e.yamlChange=0,e.yamlValue=e.updateValues.values}}},[e._v("原始values(只读)")])],1),e.yamlDialog?[t("yaml",{directives:[{name:"show",rawName:"v-show",value:e.yamlChange,expression:"yamlChange"}],attrs:{loading:e.yamlLoading,readOnly:!1},model:{value:e.updateValues.config,callback:function(a){e.$set(e.updateValues,"config",a)},expression:"updateValues.config"}}),t("yaml",{directives:[{name:"show",rawName:"v-show",value:!e.yamlChange,expression:"!yamlChange"}],attrs:{loading:e.yamlLoading,readOnly:!0},model:{value:e.yamlValue,callback:function(a){e.yamlValue=a},expression:"yamlValue"}})]:e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{plain:"",size:"small"},on:{click:function(a){e.yamlDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{plain:"",size:"small"},on:{click:function(a){return e.updateNode()}}},[e._v("确 定")])],1)],2)],1)},n=[],l=(t("a15b"),t("b0c0"),t("d3b7"),t("25f0"),t("ddb0"),t("b85c")),o=t("61b2"),r=t("b562"),i=t("5c96"),c=t("fa7d"),p=t("e2c1"),u={name:"Application",components:{Clusterbar:o["a"],Yaml:o["g"]},data:function(){return{yamlDialog:!1,yamlName:"",yamlValue:"",yamlLoading:!0,cellStyle:{border:0},maxHeight:window.innerHeight-150,loading:!0,originReleases:[],search_ns:[],search_name:"",yamlChange:1,appDetail:{},appResources:{},ingresses:[],services:[],deployments:[],statefulsets:[],daemonsets:[],jobs:[],configmaps:[],secrets:[]}},created:function(){this.fetchData()},mounted:function(){var e=this;window.onresize=function(){return function(){var a=window.innerHeight-150;e.maxHeight=a}()}},watch:{},computed:{titleName:function(){return["Applications",this.appName]},appName:function(){return this.$route.params?this.$route.params.appName:""},namespace:function(){return this.$route.params?this.$route.params.namespace:""},defaultWorkloadName:function(){for(var e=0,a=["Deployment","StatefulSet","DaemonSet","CronJob","Job"];e<a.length;e++){var t=a[e];if(this.appResources[t])return t}return"Deployment"}},methods:{dateFormat:c["a"],fetchData:function(){var e=this;this.loading=!0;var a=this.$store.state.cluster;if(a){var t={name:this.appName,namespace:this.namespace};Object(r["d"])(a,t).then((function(a){console.log(a.data),e.appDetail=a.data,e.parseResource(),e.loading=!1})).catch((function(){e.loading=!1}))}else this.loading=!1,i["Message"].error("获取集群异常，请刷新重试")},parseResource:function(){if(!this.appDetail||!this.appDetail.manifest)return{};var e=[];try{e=p.loadAll(this.appDetail.manifest,{onWarning:function(e){console.log(e)}})}catch(n){console.log(n),i["Message"].error("解析失败："+n)}var a,t=Object(l["a"])(e);try{for(t.s();!(a=t.n()).done;){var s=a.value;this.appResources[s.kind]?this.appResources[s.kind].push(s):this.appResources[s.kind]=[s]}}catch(o){t.e(o)}finally{t.f()}return console.log(this.appResources),e},getUpdateRelease:function(e,a){var t=this;this.yamlLoading=!0;var s=this.$store.state.cluster;if(this.updateValues={config:"",values:"",name:e,namespace:a},this.yamlValue="",s){var n={name:e,namespace:a,get_option:"values"};Object(r["d"])(s,n).then((function(e){t.yamlLoading=!1,t.updateValues.config=e.data.config,t.updateValues.values=e.data.values,t.yamlValue=t.updateValues.config})).catch((function(){t.yamlLoading=!1}))}else this.yamlLoading=!1,i["Message"].error("获取集群异常，请刷新重试")},nsSearch:function(e){this.search_ns=[];var a,t=Object(l["a"])(e);try{for(t.s();!(a=t.n()).done;){var s=a.value;this.search_ns.push(s)}}catch(n){t.e(n)}finally{t.f()}},nameSearch:function(e){this.search_name=e},buildNodes:function(e){if(e){var a={uid:e.metadata.uid,name:e.metadata.name,version:e.status.nodeInfo.kubeletVersion,taints:e.spec.taints?e.spec.taints.length:0,resource_version:e.metadata.resourceVersion,created:e.metadata.creationTimestamp};return a}},nameClick:function(e,a){"Ingress"!=e?"Service"!=e?"Deployment"!=e?"StatefulSet"!=e?"DaemonSet"!=e?"CronJob"!=e?"Job"!=e?"ConfigMap"!=e?"Secret"!=e?"PersistentVolumeClaim"!=e?i["Message"].error("Not found kind detail"):this.$router.push({name:"pvcDetail",params:{namespace:this.appDetail.namespace,persistentVolumeClaimName:a}}):this.$router.push({name:"secretDetail",params:{namespace:this.appDetail.namespace,secretName:a}}):this.$router.push({name:"configMapDetail",params:{namespace:this.appDetail.namespace,configMapName:a}}):this.$router.push({name:"jobDetail",params:{namespace:this.appDetail.namespace,jobName:a}}):this.$router.push({name:"cronjobDetail",params:{namespace:this.appDetail.namespace,cronjobName:a}}):this.$router.push({name:"daemonsetDetail",params:{namespace:this.appDetail.namespace,daemonsetName:a}}):this.$router.push({name:"statefulsetDetail",params:{namespace:this.appDetail.namespace,statefulsetName:a}}):this.$router.push({name:"deploymentDetail",params:{namespace:this.appDetail.namespace,deploymentName:a}}):this.$router.push({name:"serviceDetail",params:{namespace:this.appDetail.namespace,serviceName:a}}):this.$router.push({name:"ingressDetail",params:{namespace:this.appDetail.namespace,ingressName:a}})},getNodeYaml:function(e){var a=this;this.yamlName="";var t=this.$store.state.cluster;t?e?(this.yamlValue="",this.yamlDialog=!0,this.yamlLoading=!0,getNode(t,e,"yaml").then((function(t){a.yamlLoading=!1,a.yamlValue=t.data,a.yamlName=e})).catch((function(){a.yamlLoading=!1}))):i["Message"].error("获取Node名称参数异常，请刷新重试"):i["Message"].error("获取集群参数异常，请刷新重试")},deleteRelease:function(e){var a=this,t=this.$store.state.cluster;if(t){var s={name:e.name,namespace:e.namespace};this.$confirm("是否确认删除应用"+e.name+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0,Object(r["b"])(t,s).then((function(){i["Message"].success("删除成功"),a.fetchData()})).catch((function(){}))}))}else i["Message"].error("获取集群参数异常，请刷新重试")},updateNode:function(e){function a(){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(){var e=this.$store.state.cluster;e?this.yamlNamespace?this.yamlName?(console.log(this.yamlValue),updateNode(e,this.yamlNamespace,this.yamlName,this.yamlValue).then((function(){i["Message"].success("更新成功")})).catch((function(){}))):i["Message"].error("获取Node参数异常，请刷新重试"):i["Message"].error("获取命名空间参数异常，请刷新重试"):i["Message"].error("获取集群参数异常，请刷新重试")})),_delNodesFunc:function(){if(this.delNodes.length>0){var e,a=[],t=Object(l["a"])(this.delNodes);try{for(t.s();!(e=t.n()).done;){var s=e.value;a.push({namespace:s.namespace,name:s.name})}}catch(n){t.e(n)}finally{t.f()}this.deleteNodes(a)}},handleSelectionChange:function(e){this.delNodes=e,e.length>0?this.delFunc=this._delNodesFunc:this.delFunc=void 0},createFunc:function(){this.$router.push({name:"appCreate"})},getPortsDisplay:function(e){if(!e)return"";var a,t=[],s=Object(l["a"])(e);try{for(s.s();!(a=s.n()).done;){var n=a.value,o=n.port;n.nodePort&&(o+=":"+n.nodePort),n.protocol&&(o+="/"+n.protocol),t.push(o)}}catch(r){s.e(r)}finally{s.f()}return t.join(",")}}},m=u,d=(t("4d75"),t("97f0"),t("2877")),f=Object(d["a"])(m,s,n,!1,null,"5beb6964",null);a["default"]=f.exports},ee83:function(e,a,t){}}]);