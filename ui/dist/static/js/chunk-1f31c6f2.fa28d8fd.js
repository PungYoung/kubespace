(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f31c6f2"],{2978:function(e,t,a){"use strict";a.d(t,"k",(function(){return s})),a.d(t,"i",(function(){return o})),a.d(t,"j",(function(){return l})),a.d(t,"e",(function(){return r})),a.d(t,"b",(function(){return n})),a.d(t,"f",(function(){return c})),a.d(t,"a",(function(){return p})),a.d(t,"h",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"g",(function(){return g})),a.d(t,"d",(function(){return m}));var i=a("b775");function s(e){return Object(i["a"])({url:"project/apps",method:"get",params:e})}function o(e){return Object(i["a"])({url:"project/apps/status",method:"get",params:e})}function l(e){return Object(i["a"])({url:"project/apps/versions",method:"get",params:e})}function r(e){return Object(i["a"])({url:"project/apps/".concat(e),method:"get"})}function n(e){return Object(i["a"])({url:"project/apps/".concat(e),method:"delete"})}function c(e){return Object(i["a"])({url:"project/apps/version/".concat(e),method:"get"})}function p(e){return Object(i["a"])({url:"/project/apps",method:"post",data:e})}function d(e){return Object(i["a"])({url:"/project/apps/install",method:"post",data:e})}function u(e){return Object(i["a"])({url:"/project/apps/destroy",method:"post",data:e})}function g(e){return Object(i["a"])({url:"/project/apps/import_storeapp",method:"post",data:e})}function m(e){return Object(i["a"])({url:"/project/apps/duplicate_app",method:"post",data:e})}},"2ad9":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return o})),a.d(t,"e",(function(){return l})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));var i=a("b775");function s(e){return Object(i["a"])({url:"pipeline/pipeline",method:"get",params:{workspace_id:e}})}function o(e){return Object(i["a"])({url:"pipeline/pipeline/".concat(e),method:"get"})}function l(e){return Object(i["a"])({url:"pipeline/pipeline",method:"put",data:e})}function r(e){return Object(i["a"])({url:"pipeline/pipeline",method:"post",data:e})}function n(e){return Object(i["a"])({url:"pipeline/pipeline/".concat(e),method:"delete"})}},"5e82":function(e,t,a){},"60ef":function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return o})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return r}));var i=a("b775");function s(){return Object(i["a"])({url:"/settings/image_registry",method:"get"})}function o(e){return Object(i["a"])({url:"/settings/image_registry",method:"post",data:e})}function l(e,t){return Object(i["a"])({url:"/settings/image_registry/".concat(e),method:"put",data:t})}function r(e){return Object(i["a"])({url:"/settings/image_registry/".concat(e),method:"delete"})}},"673a":function(e,t,a){},"6a5e":function(e,t,a){"use strict";var i=a("673a"),s=a.n(i);s.a},"7eac":function(e,t,a){},a249:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("clusterbar",{attrs:{titleName:e.titleName,titleLink:["pipeline"]}},[a("div",{attrs:{slot:"right-btn"},slot:"right-btn"},[a("el-button",{staticClass:"bar-btn",attrs:{size:"small",type:""},on:{click:e.cancelEdit}},[e._v("取消")]),a("el-button",{staticClass:"bar-btn",attrs:{size:"small",type:"primary"},on:{click:e.savePipeline}},[e._v("保存")])],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container",style:{height:e.maxHeight+"px"},attrs:{"max-height":e.maxHeight}},[a("div",{staticStyle:{padding:"10px 8px 0px"}},[a("div",[e._v("基本信息")]),a("el-form",{staticClass:"pipeline-form-item",attrs:{"label-position":"left","label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入流水线名称",size:"small"},model:{value:e.editPipeline.name,callback:function(t){e.$set(e.editPipeline,"name",t)},expression:"editPipeline.name"}})],1)],1)],1),a("div",{staticStyle:{padding:"10px 8px 0px"}},[a("div",[e._v("阶段任务")]),a("div",{staticClass:"stage-job-outer"},[a("div",{staticClass:"stage-job-line"},["code"==e.workspace.type?a("div",{staticClass:"pipeline-source-outer",staticStyle:{display:"inline-block"},on:{click:function(t){return e.openEditSource()}}},[a("span",{staticClass:"pipeline-source-outer__span"},[e._v(" 代码库源 ")]),a("div",{staticStyle:{"font-size":"12px",padding:"10px 0px 0px","font-weight":"450"}},[e._v(" "+e._s(e.workspace?e.workspace.code_url:"")+" ")]),e._l(e.editPipeline.triggers,(function(t,i){return a("div",{key:i,staticStyle:{"font-size":"12px",padding:"5px 10px 0px","font-weight":"400"}},[a("svg-icon",{attrs:{"icon-class":"branch"}}),e._v(" "+e._s(e.operatorMap[t.operator])+" "+e._s(t.branch)+" ")],1)}))],2):e._e()]),a("div",{staticStyle:{display:"inline-block"}},[a("div",{staticStyle:{"margin-top":"43px",width:"38px"}},[a("div",{staticClass:"stage-job-line__inner",staticStyle:{width:"20px"}}),a("div",{staticClass:"stage-job-line__add",on:{click:function(t){e.openAddStageDialog(0),e.dialogVisible=!0}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"添加阶段",placement:"top","hide-after":2e3}},[a("i",{staticClass:"el-icon-circle-plus"})])],1)])]),e._l(e.editPipeline.stages,(function(t,i){return a("div",{key:i},[a("div",{staticClass:"stage-job-line"},[a("div",{staticClass:"stage-job-block"},[a("div",{staticClass:"stage-job-block__stage",on:{click:function(a){e.openEditStageDialog(t,i),e.dialogVisible=!0}}},[a("span",[e._v("#"+e._s(i+1)+" "+e._s(t.name))])])]),a("div",[a("div",{staticClass:"stage-job-line__inner"}),a("a",{class:e.checkJobError(t.jobs[0])?"stage-job-line__circle":"stage-job-line__circle-error",on:{click:function(a){e.openEditJobDialog(t,0),e.dialogVisible=!0}}},[e._v(" "+e._s(e.checkJobError(t.jobs[0])?"":"!")+" ")]),a("div",{staticClass:"stage-job-line__inner"}),a("div",{staticClass:"stage-job-line__add",on:{click:function(t){e.openAddStageDialog(i+1),e.dialogVisible=!0}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"添加阶段",placement:"top","hide-after":2e3}},[a("i",{staticClass:"el-icon-circle-plus"})])],1)]),a("div",{staticClass:"stage-job-block"},[a("div",{staticClass:"stage-job-block__job-name"},[e._v(e._s(t.jobs[0].name))])]),a("div",{staticClass:"stage-job-block"},[t.jobs&&t.jobs.length>1?e._l(t.jobs,(function(i,s){return a("div",{key:s},[s>0?[a("div",{staticClass:"stage-job-block__job"},[a("div",{staticClass:"stage-job-block__job-circle"},[a("div",{class:e.checkJobError(i)?"stage-job-line__circle":"stage-job-line__circle-error",on:{click:function(a){e.openEditJobDialog(t,s),e.dialogVisible=!0}}},[a("span",{staticStyle:{"margin-top":"-5px"}},[e._v(e._s(e.checkJobError(i)?"":"!"))])])])]),a("div",{staticClass:"stage-job-block__job-name",staticStyle:{"margin-top":"18px"}},[e._v(e._s(i.name))])]:e._e()],2)})):e._e(),a("div",{staticClass:"stage-job-block__job-add"},[a("div",{staticClass:"stage-job-block__job-add__inner"},[a("span",{staticClass:"stage-job-block__job-add__inner-name",on:{click:function(a){e.openAddJobDialog(t),e.dialogVisible=!0}}},[e._v("+ 新建并行任务")])])])],2)])])}))],2)])]),a("el-dialog",{attrs:{title:e.dialogTitleMap[e.dialogType],visible:e.dialogVisible,"destroy-on-close":!0,top:"3vh",width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){e.dialogType="",e.dialogData={}}}},[a("div",{staticClass:"dialogContent",staticStyle:{padding:"0px 30px"}},["edit_stage"==e.dialogType||"add_stage"==e.dialogType?[a("pipeline-stage",{attrs:{stage:e.dialogData}})]:e._e(),"edit_job"==e.dialogType||"add_job"==e.dialogType?[a("el-form",{ref:"stage",attrs:{model:e.dialogData,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"任务名称",prop:"",required:!0}},[a("el-input",{staticStyle:{width:"250px"},attrs:{autocomplete:"off",size:"small"},model:{value:e.dialogData.name,callback:function(t){e.$set(e.dialogData,"name",t)},expression:"dialogData.name"}})],1),a("el-form-item",{attrs:{label:"任务插件",prop:"",required:!0}},[a("el-select",{staticStyle:{width:"250px"},attrs:{placeholder:"任务插件",size:"small"},on:{change:function(t){e.dialogData.params={}}},model:{value:e.dialogData.plugin_key,callback:function(t){e.$set(e.dialogData,"plugin_key",t)},expression:"dialogData.plugin_key"}},e._l(e.jobPlugins,(function(e){return a("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1)],1),e.jobPluginMap[e.dialogData.plugin_key]?a("div",{staticStyle:{"background-color":"#F2F6FC",padding:"15px"}},[e.jobPluginMap[e.dialogData.plugin_key]?a(e.jobPluginMap[e.dialogData.plugin_key].component,{tag:"component",attrs:{params:e.dialogData.params}}):e._e()],1):e._e()],1)]:e._e(),"source"==e.dialogType?[a("el-form",{attrs:{model:e.dialogData,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"代码库源",prop:"",required:!0}},[a("el-input",{staticStyle:{width:"450px"},attrs:{disabled:!0,size:"small"},model:{value:e.workspace.code_url,callback:function(t){e.$set(e.workspace,"code_url",t)},expression:"workspace.code_url"}})],1),a("el-form-item",{attrs:{label:"触发分支",prop:"",required:!0}},[a("el-row",{staticStyle:{"margin-bottom":"5px","margin-top":"8px"}},[a("el-col",{staticStyle:{"background-color":"#F5F7FA","padding-left":"10px"},attrs:{span:7}},[a("div",{staticClass:"border-span-header"},[a("span",{staticClass:"border-span-content"},[e._v("*")]),e._v("匹配方式 ")])]),a("el-col",{staticStyle:{"background-color":"#F5F7FA"},attrs:{span:10}},[a("div",{staticClass:"border-span-header"},[e._v(" 分支 ")])])],1),e._l(e.editPipeline.triggers,(function(t,i){return a("el-row",{key:i,staticStyle:{"padding-bottom":"5px"}},[a("el-col",{attrs:{span:7}},[a("div",{staticClass:"border-span-header",staticStyle:{"margin-right":"10px"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"匹配方式",size:"small"},model:{value:t.operator,callback:function(a){e.$set(t,"operator",a)},expression:"d.operator"}},[a("el-option",{attrs:{label:"精确匹配",value:"equal"}}),a("el-option",{attrs:{label:"精确排除",value:"exclude"}}),a("el-option",{attrs:{label:"正则匹配",value:"regex"}})],1)],1)]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"border-span-header"},[a("el-input",{staticStyle:{"border-radius":"0px"},attrs:{size:"small",placeholder:"匹配分支，空表示所有分支"},model:{value:t.branch,callback:function(a){e.$set(t,"branch",a)},expression:"d.branch"}})],1)]),a("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:2}},[a("el-button",{staticStyle:{padding:"5px"},attrs:{circle:"",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.editPipeline.triggers.splice(i,1)}}})],1)],1)})),a("el-row",[a("el-col",{attrs:{span:17}},[a("el-button",{staticStyle:{width:"100%","border-radius":"0px",padding:"9px 15px","border-color":"rgb(102, 177, 255)",color:"rgb(102, 177, 255)"},attrs:{plain:"",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.editPipeline.triggers.push({type:"code",branch_type:"branch",operator:"equal",branch:""})}}},[e._v("添加匹配")])],1)],1)],2)],1)]:e._e()],2),a("div",{staticClass:"dialogFooter",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),"edit_job"==e.dialogType||"edit_stage"==e.dialogType?[a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"danger"},on:{click:e.dialogDelete}},[e._v("删 除")])]:e._e(),a("el-button",{attrs:{type:"primary"},on:{click:e.dialogSave}},[e._v("确 定")])],2)])],1)},s=[],o=(a("a434"),a("b0c0"),a("b85c")),l=a("61b2"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"stage",attrs:{model:e.stage,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"阶段名称",prop:"name",required:!0}},[a("el-input",{staticStyle:{width:"250px"},attrs:{autocomplete:"off",size:"small",placeholder:"未命名"},model:{value:e.stage.name,callback:function(t){e.$set(e.stage,"name",t)},expression:"stage.name"}})],1),a("el-form-item",{attrs:{label:"触发方式",prop:"type"}},[a("el-radio-group",{model:{value:e.stage.trigger_mode,callback:function(t){e.$set(e.stage,"trigger_mode",t)},expression:"stage.trigger_mode"}},[a("el-radio",{attrs:{label:"auto"}},[e._v("自动触发")]),a("el-radio",{attrs:{label:"manual"}},[e._v("手动触发")])],1)],1),a("el-form-item",{attrs:{label:"阶段参数",prop:"type"}},[a("el-row",{staticStyle:{"margin-bottom":"5px","margin-top":"8px"}},[a("el-col",{staticStyle:{"background-color":"#F5F7FA","padding-left":"10px"},attrs:{span:7}},[a("div",{staticClass:"border-span-header"},[a("span",{staticClass:"border-span-content"},[e._v("*")]),e._v("参数 ")])]),a("el-col",{staticStyle:{"background-color":"#F5F7FA"},attrs:{span:10}},[a("div",{staticClass:"border-span-header"},[e._v(" 默认值 ")])])],1),e._l(e.stage.custom_params,(function(t,i){return a("el-row",{key:i,staticStyle:{"padding-bottom":"5px"}},[a("el-col",{attrs:{span:7}},[a("div",{staticClass:"border-span-header"},[a("el-input",{staticStyle:{"padding-right":"10px"},attrs:{size:"small",placeholder:"阶段参数"},model:{value:t.param,callback:function(a){e.$set(t,"param",a)},expression:"d.param"}})],1)]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"border-span-header"},[a("el-input",{attrs:{size:"small",placeholder:"请输入参数默认值"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"d.value"}})],1)]),a("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:2}},[a("el-button",{staticStyle:{padding:"5px"},attrs:{circle:"",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.stage.custom_params.splice(i,1)}}})],1)],1)})),a("el-row",[a("el-col",{attrs:{span:17}},[a("el-button",{staticStyle:{width:"100%","border-radius":"0px",padding:"9px 15px","border-color":"rgb(102, 177, 255)",color:"rgb(102, 177, 255)"},attrs:{plain:"",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.stage.custom_params.push({})}}},[e._v("添加自定义参数")])],1)],1)],2)],1)],1)},n=[],c={name:"PipelineStage",data:function(){return{}},props:["stage"]},p=c,d=a("2877"),u=Object(d["a"])(p,r,n,!1,null,"9ebe7a90",null),g=u.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{ref:"stage",attrs:{model:e.params,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"编译",prop:""}},[a("el-switch",{model:{value:e.params.code_build,callback:function(t){e.$set(e.params,"code_build",t)},expression:"params.code_build"}})],1),e.params.code_build?[a("el-form-item",{attrs:{label:"编译镜像",prop:"",required:!0}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择编译镜像",size:"small"},model:{value:e.params.code_build_image,callback:function(t){e.$set(e.params,"code_build_image",t)},expression:"params.code_build_image"}},e._l(e.imageResources,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"编译方式",prop:""}},[a("el-radio-group",{model:{value:e.params.code_build_type,callback:function(t){e.$set(e.params,"code_build_type",t)},expression:"params.code_build_type"}},[a("el-radio",{attrs:{label:"file"}},[e._v("脚本文件")]),a("el-radio",{attrs:{label:"script"}},[e._v("自定义脚本")])],1)],1),"file"==e.params.code_build_type?a("el-form-item",{attrs:{label:"编译文件",prop:""}},[a("el-input",{staticStyle:{width:"320px"},attrs:{autocomplete:"off",size:"small",placeholder:"默认为当前代码库根目录下的「build.sh」文件"},model:{value:e.params.code_build_file,callback:function(t){e.$set(e.params,"code_build_file",t)},expression:"params.code_build_file"}})],1):e._e(),"script"==e.params.code_build_type?a("el-form-item",{attrs:{label:"编译脚本",prop:""}},[a("el-input",{attrs:{type:"textarea",rows:6,autocomplete:"off",size:"small"},model:{value:e.params.code_build_script,callback:function(t){e.$set(e.params,"code_build_script",t)},expression:"params.code_build_script"}})],1):e._e()]:e._e(),a("el-divider"),a("el-form-item",{attrs:{label:"镜像仓库",prop:"",required:!0}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择镜像要推送的仓库",size:"small"},model:{value:e.params.image_build_registry,callback:function(t){e.$set(e.params,"image_build_registry",t)},expression:"params.image_build_registry"}},e._l(e.registry,(function(e){return a("el-option",{key:e.id,attrs:{label:e.registry,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"构建镜像",prop:"",required:!0}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("span",[e._v("Dockerfile")])]),a("el-col",{attrs:{span:13}},[a("span",[e._v("镜像名称")])]),a("el-col",{attrs:{span:3}})],1),e._l(e.params.image_builds,(function(t,i){return a("el-row",{key:i,attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"默认为Dockerfile",autocomplete:"off",size:"small"},model:{value:t.dockerfile,callback:function(a){e.$set(t,"dockerfile",a)},expression:"build.dockerfile"}})],1),a("el-col",{attrs:{span:13}},[a("el-input",{attrs:{autocomplete:"off",size:"small"},model:{value:t.image,callback:function(a){e.$set(t,"image",a)},expression:"build.image"}})],1),a("el-col",{attrs:{span:3}},[e.params.image_builds.length>1?a("span",{staticClass:"build-info-operator",staticStyle:{"margin-right":"5px"},on:{click:function(t){return e.params.image_builds.splice(i,1)}}},[e._v("—")]):e._e(),i+1==e.params.image_builds.length?a("span",{staticClass:"build-info-operator",on:{click:function(t){return e.addBuildInfo()}}},[e._v("+")]):e._e()])],1)}))],2)],2)],1)},b=[],f=a("d32e"),h=a("60ef"),_={name:"CodeToImage",data:function(){return{image_builds:[],resources:[],registry:[],loading:!1}},props:["params"],computed:{workspaceId:function(){return this.$route.params.workspaceId},imageResources:function(){var e,t=[],a=Object(o["a"])(this.resources);try{for(a.s();!(e=a.n()).done;){var i=e.value;"image"==i.type&&t.push(i)}}catch(s){a.e(s)}finally{a.f()}return t}},beforeMount:function(){void 0==this.params.code_build&&this.$set(this.params,"code_build",!0),this.params.code_build_type||this.$set(this.params,"code_build_type","file"),this.params.image_builds||this.$set(this.params,"image_builds",[{dockerfile:"",image:""}]),this.fetchResources(),this.fetchImageRegistry()},methods:{fetchResources:function(){var e=this;this.loading=!0,Object(f["c"])(this.workspaceId).then((function(t){e.resources=t.data?t.data:[],e.loading=!1})).catch((function(t){e.loading=!1}))},fetchImageRegistry:function(){var e=this;this.loading=!0,Object(h["c"])().then((function(t){e.registry=t.data?t.data:[],e.loading=!1})).catch((function(t){console.log(t),e.loading=!1}))},addBuildInfo:function(){this.params.image_build_infos.push({dockerfile:"",image_name:""}),console.log(this.job)}}},v=_,y=(a("b280"),Object(d["a"])(v,m,b,!1,null,"042b8232",null)),k=y.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{ref:"job",attrs:{model:e.params,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"目标资源",prop:"",required:!0}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择要执行的目标资源",size:"small"},model:{value:e.params.resource,callback:function(t){e.$set(e.params,"resource",t)},expression:"params.resource"}},e._l(e.resources,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"脚本类型",prop:""}},[a("el-radio-group",{model:{value:e.params.shell,callback:function(t){e.$set(e.params,"shell",t)},expression:"params.shell"}},[a("el-radio",{attrs:{label:"bash"}},[e._v("bash")]),a("el-radio",{attrs:{label:"sh"}},[e._v("sh")])],1)],1),a("el-form-item",{attrs:{label:"执行脚本",prop:""}},[a("el-input",{attrs:{type:"textarea",rows:6,autocomplete:"off",size:"small"},model:{value:e.params.script,callback:function(t){e.$set(e.params,"script",t)},expression:"params.script"}})],1)],1)],1)},x=[],w={name:"ExecuteShell",data:function(){return{loading:!1,resources:[]}},props:["params"],computed:{workspaceId:function(){return this.$route.params.workspaceId}},beforeMount:function(){this.params.shell||this.$set(this.params,"shell","bash"),this.fetchResources()},methods:{fetchResources:function(){var e=this;this.loading=!0,Object(f["c"])(this.workspaceId).then((function(t){e.resources=t.data?t.data:[],e.loading=!1})).catch((function(t){e.loading=!1}))}}},D=w,O=Object(d["a"])(D,j,x,!1,null,"10d07fa0",null),S=O.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{ref:"job",attrs:{model:e.params,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"工作空间",prop:"",required:!0}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择工作空间",size:"small"},on:{change:e.fetchApps},model:{value:e.params.project,callback:function(t){e.$set(e.params,"project",t)},expression:"params.project"}},e._l(e.projects,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"应用",prop:""}},[a("el-select",{staticStyle:{width:"320px"},attrs:{placeholder:"请选择要更新的应用",size:"small",multiple:""},model:{value:e.params.apps,callback:function(t){e.$set(e.params,"apps",t)},expression:"params.apps"}},e._l(e.apps,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"是否部署",prop:""}},[a("el-switch",{model:{value:e.params.with_install,callback:function(t){e.$set(e.params,"with_install",t)},expression:"params.with_install"}})],1)],1)],1)},$=[],P=a("4fee"),I=a("2978"),T={name:"AppDeploy",data:function(){return{loading:!1,resources:[],projects:[],apps:[]}},props:["params"],computed:{workspaceId:function(){return this.$route.params.workspaceId}},beforeMount:function(){void 0==this.params.with_install&&this.$set(this.params,"with_install",!0),void 0==this.params.apps&&this.$set(this.params,"apps",[])},mounted:function(){this.fetchProjects()},methods:{fetchProjects:function(){var e=this;Object(P["d"])().then((function(t){e.projects=t.data?t.data:[],e.projects.sort((function(e,t){return e.name>t.name?1:-1}))})).catch((function(e){console.log(e)}))},fetchApps:function(){var e=this;this.apps=[],this.$set(this.params,"apps",[]),Object(I["k"])({scope_id:this.params.project,scope:"project_app"}).then((function(t){var a=t.data?t.data:[];e.apps=a})).catch((function(e){}))}}},z=T,E=Object(d["a"])(z,C,$,!1,null,"5b2fa733",null),F=E.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-form",{ref:"job",attrs:{model:e.params,"label-position":"left","label-width":"105px"}},[a("span",[e._v("发布插件：发布后会根据执行输入的版本号，给代码仓库打上版本标签，同时会给构建出来的镜像打上版本标签，并推送到镜像仓库")])])],1)},q=[],A={name:"Release",data:function(){return{loading:!1}},props:["params"],computed:{},beforeMount:function(){},mounted:function(){},methods:{}},J=A,V=Object(d["a"])(J,M,q,!1,null,"64f175ca",null),N=V.exports,R=a("2ad9"),H=a("6895"),B=a("5c96"),K={name:"PipelineEdit",components:{Clusterbar:l["a"],PipelineStage:g,CodeToImage:k,ExecuteShell:S,AppDeploy:F,Release:N},data:function(){return{titleName:["流水线"],users:[],cellStyle:{border:0,padding:"1px 0","line-height":"35px"},maxHeight:window.innerHeight-145,loading:!0,pipeline:{},workspace:{},editPipeline:{workspace_id:parseInt(this.$route.params.workspaceId),id:0,name:"",triggers:[{type:"code",branch_type:"branch",operator:"equal",branch:""}],stages:[]},operatorMap:{equal:"==",exclude:"<>",regex:"~="},dialogVisible:!1,dialogOriginData:{},dialogData:{},dialogType:"",jobPlugins:[{key:"build_code_to_image",name:"构建代码镜像",component:"CodeToImage"},{key:"execute_shell",name:"执行shell脚本",component:"ExecuteShell"},{key:"release",name:"发布",component:"Release"},{key:"k8s_deploy",name:"Kubernetes资源部署",component:"K8sDeploy"},{key:"upgrade_app",name:"应用部署",component:"AppDeploy"}],dialogTitleMap:{edit_stage:"编辑阶段",edit_job:"编辑任务",add_stage:"添加阶段",add_job:"添加任务",source:"流水线源"}}},created:function(){this.fetchWorkspace(),this.pipelineId?this.fetchPipeline():(this.titleName=["流水线","创建"],this.loading=!1)},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-145;console.log(t),e.maxHeight=t}()}},computed:{workspaceId:function(){return this.$route.params.workspaceId},pipelineId:function(){return this.$route.params.pipelineId},jobPluginMap:function(){var e,t={},a=Object(o["a"])(this.jobPlugins);try{for(a.s();!(e=a.n()).done;){var i=e.value;t[i.key]=i}}catch(s){a.e(s)}finally{a.f()}return t},dialogTitle:function(){if("edit_stage"==this.dialogType)return"编辑"}},methods:{fetchWorkspace:function(){var e=this;this.loading=!0,Object(H["e"])(this.workspaceId).then((function(t){e.workspace=t.data||{},e.loading=!1})).catch((function(){e.loading=!1}))},fetchPipeline:function(){var e=this;this.loading=!0,Object(R["c"])(this.pipelineId).then((function(t){if(e.pipeline=t.data||{},e.pipeline){e.titleName=["流水线",e.pipeline.pipeline.name],e.editPipeline={id:e.pipeline.pipeline.id,workspace_id:e.pipeline.workspace.id,name:e.pipeline.pipeline.name,triggers:e.pipeline.pipeline.triggers,stages:[]};var a,i=Object(o["a"])(e.pipeline.stages);try{for(i.s();!(a=i.n()).done;){var s=a.value;e.editPipeline.stages.push({id:s.id,name:s.name,trigger_mode:s.trigger_mode,jobs:s.jobs,custom_params:s.custom_params})}}catch(l){i.e(l)}finally{i.f()}}e.loading=!1})).catch((function(){e.loading=!1}))},savePipeline:function(){var e=this;this.loading=!0,this.editPipeline.name?this.pipelineId?Object(R["e"])(this.editPipeline).then((function(t){B["Message"].success("编辑流水线成功"),e.$router.push({name:"pipeline",params:{workspaceId:e.workspaceId}})})).catch((function(){e.loading=!1})):Object(R["a"])(this.editPipeline).then((function(t){B["Message"].success("创建流水线成功"),e.$router.push({name:"pipeline",params:{workspaceId:e.workspaceId}})})).catch((function(){e.loading=!1})):B["Message"].error("请输入流水线名称")},cancelEdit:function(){this.$router.push({name:"pipeline",params:{workspaceId:this.workspaceId}})},dialogSave:function(){var e={};if(("edit_stage"==this.dialogType||"add_stage"==this.dialogType)&&this.dialogData.custom_params){var t,a=Object(o["a"])(this.dialogData.custom_params);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!i.param)return void B["Message"].error("阶段参数值不能为空");e[i.param]=i.value||""}}catch(r){a.e(r)}finally{a.f()}}if("edit_stage"==this.dialogType)this.dialogOriginData.stage.name=this.dialogData.name,this.dialogOriginData.stage.trigger_mode=this.dialogData.trigger_mode,this.$set(this.dialogOriginData.stage,"custom_params",e);else if("edit_job"==this.dialogType){var s=this.dialogOriginData.idx;this.dialogOriginData.stage.jobs[s]=this.dialogData}else if("add_stage"==this.dialogType){var l={name:this.dialogData.name||"未命名",trigger_mode:this.dialogData.trigger_mode,custom_params:e,jobs:[{name:"未命名",plugin_key:"",params:{}}]};this.editPipeline.stages.splice(this.dialogOriginData,0,l)}else"add_job"==this.dialogType&&this.dialogOriginData.jobs.push(this.dialogData);this.dialogVisible=!1},dialogDelete:function(){if("edit_stage"==this.dialogType)this.editPipeline.stages.splice(this.dialogOriginData.idx,1);else if("edit_job"==this.dialogType)if(1==this.dialogOriginData.stage.jobs.length){var e={name:"未命名",plugin_key:"",params:{}};this.dialogOriginData.stage.jobs[0]=e}else this.dialogOriginData.stage.jobs.splice(this.dialogOriginData.idx,1);this.dialogVisible=!1},openEditStageDialog:function(e,t){this.dialogType="edit_stage",this.dialogOriginData={stage:e,idx:t},console.log(e);var a=[];if(e.custom_params)for(var i in e.custom_params)a.push({param:i,value:e.custom_params[i]});this.dialogData={name:e.name,trigger_mode:e.trigger_mode,custom_params:a}},openEditJobDialog:function(e,t){this.dialogType="edit_job",this.dialogOriginData={stage:e,idx:t},this.dialogData=JSON.parse(JSON.stringify(e.jobs[t]))},openAddStageDialog:function(e){this.dialogType="add_stage",this.dialogOriginData=e,this.dialogData={name:"",trigger_mode:"auto",custom_params:[]}},openAddJobDialog:function(e){this.dialogType="add_job",this.dialogOriginData=e,this.dialogData={name:"未命名",plugin_key:"",params:{}}},checkJobError:function(e){return""!=e.name&&""!=e.plugin_key},openEditSource:function(){this.dialogType="source",this.dialogData={},console.log(this.editPipeline),this.dialogVisible=!0}}},W=K,L=(a("d6b2"),a("6a5e"),Object(d["a"])(W,i,s,!1,null,"161e5022",null));t["default"]=L.exports},b280:function(e,t,a){"use strict";var i=a("5e82"),s=a.n(i);s.a},d32e:function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return o})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return r}));var i=a("b775");function s(e){return Object(i["a"])({url:"pipeline/resource/".concat(e),method:"get"})}function o(e){return Object(i["a"])({url:"/pipeline/resource",method:"post",data:e})}function l(e,t){return Object(i["a"])({url:"/pipeline/resource/".concat(e),method:"put",data:t})}function r(e){return Object(i["a"])({url:"/pipeline/resource/".concat(e),method:"delete"})}},d6b2:function(e,t,a){"use strict";var i=a("7eac"),s=a.n(i);s.a}}]);