(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-739493e4"],{"1d71":function(e,t,o){"use strict";var r=o("4934"),a=o.n(r);a.a},4934:function(e,t,o){},a244:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("clusterbar",{attrs:{titleName:e.titleName,nameFunc:e.nameSearch,createFunc:e.createFormDialog,createDisplay:"创建资源"}}),o("div",{ref:"tableCot",staticClass:"dashboard-container"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.originResources,"cell-style":e.cellStyle,"default-sort":{prop:"name"},"tooltip-effect":"dark"}},[o("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":"","min-width":"13"}}),o("el-table-column",{attrs:{prop:"global",label:"全局共享","show-overflow-tooltip":"","min-width":"8"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.global?"是":"否")+" ")]}}])}),o("el-table-column",{attrs:{prop:"roles",label:"类型","show-overflow-tooltip":"","min-width":"8"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.typeMap[t.row.type])+" ")]}}])}),o("el-table-column",{attrs:{prop:"value",label:"资源地址","show-overflow-tooltip":"","min-width":"15"}}),o("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":"","min-width":"18"}}),o("el-table-column",{attrs:{prop:"update_user",label:"操作人","show-overflow-tooltip":"","min-width":"10"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.update_user)+" ")]}}])}),o("el-table-column",{attrs:{prop:"update_time",label:"更新时间","show-overflow-tooltip":"","min-width":"15"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$dateFormat(t.row.update_time))+" ")]}}])}),o("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.workspace_id==e.workspaceId?o("div",{staticClass:"tableOperate"},[o("el-link",{staticStyle:{"margin-right":"15px"},attrs:{disabled:!e.$editorRole(),underline:!1,type:"primary"},on:{click:function(o){return e.updateFormDialog(t.row)}}},[e._v("编辑")]),o("el-link",{attrs:{disabled:!e.$editorRole(),underline:!1,type:"danger"},on:{click:function(o){return e.handleDeleteResource(t.row.id,t.row.name)}}},[e._v("删除")])],1):e._e()]}}])})],1),o("el-dialog",{attrs:{title:e.updateVisible?"修改资源":"创建流水线资源",visible:e.createFormVisible,"destroy-on-close":!0},on:{"update:visible":function(t){e.createFormVisible=t},close:e.closeDialog}},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[o("div",{staticClass:"dialogContent"},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"left","label-width":"105px"}},[o("el-form-item",{attrs:{label:"资源名称",prop:"name"}},[o("el-input",{attrs:{disabled:e.updateVisible,autocomplete:"off",placeholder:"请输入资源名称",size:"small"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:"资源类型",prop:"type",size:"small"}},[o("el-radio-group",{attrs:{disabled:e.updateVisible},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[o("el-radio-button",{attrs:{label:"image"}},[e._v("容器镜像")]),o("el-radio-button",{attrs:{label:"host"}},[e._v("主 机")])],1)],1),o("el-form-item",{attrs:{label:"全局共享",required:""}},[o("el-switch",{model:{value:e.form.global,callback:function(t){e.$set(e.form,"global",t)},expression:"form.global"}})],1),"image"==e.form.type?o("el-form-item",{attrs:{label:"镜像地址",required:""}},[o("el-input",{attrs:{autocomplete:"off",clearable:"",placeholder:"请输入容器镜像地址",size:"small"},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}})],1):e._e(),"host"==e.form.type?o("el-form-item",{attrs:{label:"主机地址",required:""}},[o("el-input",{attrs:{autocomplete:"off",clearable:"",placeholder:"请输入主机地址",size:"small"},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}})],1):e._e(),o("el-form-item",{attrs:{label:"认证密钥"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择访问认证密钥",size:"small"},model:{value:e.form.secret_id,callback:function(t){e.$set(e.form,"secret_id",t)},expression:"form.secret_id"}},[o("el-option",{attrs:{label:"",value:""}},[e._v("不选择")]),e._l("image"==e.form.type?e.imageSecrets:e.hostSecrets,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],2)],1),o("el-form-item",{attrs:{label:"描述",prop:"description"}},[o("el-input",{attrs:{type:"textarea",autocomplete:"off",placeholder:"请输入资源描述",size:"small"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),o("div",{staticClass:"dialogFooter",staticStyle:{"margin-top":"15px"},attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{"margin-right":"20px"},on:{click:function(t){e.createFormVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updateVisible?e.handleUpdateResource():e.handleCreateResource()}}},[e._v("确 定")])],1)])])],1)],1)},a=[],i=(o("a4d3"),o("e01a"),o("b0c0"),o("b85c")),l=o("61b2"),s=o("f7ec"),n=o("d32e"),c=o("5c96"),u={name:"resource",components:{Clusterbar:l["a"]},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-150;e.maxHeight=t}()}},data:function(){return{maxHeight:window.innerHeight-150,cellStyle:{border:0},titleName:["资源管理"],loading:!0,createFormVisible:!1,updateVisible:!1,dialogLoading:!1,form:{id:"",name:"",description:"",value:"",type:"image",secret_id:"",global:!1},typeMap:{image:"镜像",host:"主机"},rules:{name:[{required:!0,message:" ",trigger:"blur"}],type:[{required:!0,message:" ",trigger:"blur"}],value:[{required:!0,message:" ",trigger:"blur"}]},originResources:[],search_name:"",secrets:[]}},created:function(){this.fetchResources()},computed:{workspaceId:function(){return this.$route.params.workspaceId},imageSecrets:function(){var e,t=[],o=Object(i["a"])(this.secrets);try{for(o.s();!(e=o.n()).done;){var r=e.value;"password"==r.type&&t.push(r)}}catch(a){o.e(a)}finally{o.f()}return t},hostSecrets:function(){var e,t=[],o=Object(i["a"])(this.secrets);try{for(o.s();!(e=o.n()).done;){var r=e.value;"password"!=r.type&&"key"!=r.type||t.push(r)}}catch(a){o.e(a)}finally{o.f()}return t}},methods:{handleEdit:function(e,t){console.log(e,t)},fetchResources:function(){var e=this;this.loading=!0,Object(n["c"])(this.workspaceId).then((function(t){e.originResources=t.data?t.data:[],e.loading=!1})).catch((function(t){e.loading=!1}))},fetchSecrets:function(){var e=this;Object(s["c"])().then((function(t){e.secrets=t.data?t.data:[]})).catch((function(t){e.loading=!1}))},handleCreateResource:function(){var e=this;if(this.form.name)if(this.form.type)if(this.form.value){var t={workspace_id:parseInt(this.workspaceId),name:this.form.name,type:this.form.type,value:this.form.value,description:this.form.description,global:this.form.global};this.form.secret_id&&(t["secret_id"]=this.form.secret_id),this.dialogLoading=!0,Object(n["a"])(t).then((function(){e.dialogLoading=!1,e.createFormVisible=!1,c["Message"].success("创建资源成功"),e.fetchResources()})).catch((function(t){e.dialogLoading=!1}))}else c["Message"].error("资源地址不能为空");else c["Message"].error("资源类型不能为空，请重新选择");else c["Message"].error("资源名称不能为空")},handleUpdateResource:function(){var e=this;if(this.form.id)if(this.form.value){var t={value:this.form.value,description:this.form.description,global:this.form.global};this.form.secret_id&&(t["secret_id"]=this.form.secret_id),this.dialogLoading=!0,Object(n["d"])(this.form.id,t).then((function(){e.dialogLoading=!1,e.createFormVisible=!1,c["Message"].success("更新资源成功"),e.fetchResources()})).catch((function(t){e.dialogLoading=!1}))}else c["Message"].error("资源地址不能为空");else c["Message"].error("获取资源id参数异常，请刷新重试")},handleDeleteResource:function(e,t){var o=this;e?this.$confirm("请确认是否删除「".concat(t,"」此资源?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["b"])(e).then((function(){c["Message"].success("删除资源成功"),o.fetchResources()})).catch((function(e){console.log(e)}))})).catch((function(){})):c["Message"].error("获取资源id参数异常，请刷新重试")},nameSearch:function(e){this.search_name=e},createFormDialog:function(){this.fetchSecrets(),this.form={id:"",name:"",description:"",value:"",type:"image",secret_id:"",global:!1},this.createFormVisible=!0},updateFormDialog:function(e){this.fetchSecrets(),this.form={id:e.id,name:e.name,description:e.description,type:e.type,value:e.value,global:e.global},e.secret_id&&(this.form.secret_id=e.secret_id),this.updateVisible=!0,this.createFormVisible=!0},closeDialog:function(){this.updateVisible=!1,this.createFormVisible=!1}}},d=u,f=(o("1d71"),o("2877")),m=Object(f["a"])(d,r,a,!1,null,"15371440",null);t["default"]=m.exports},d32e:function(e,t,o){"use strict";o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return i})),o.d(t,"d",(function(){return l})),o.d(t,"b",(function(){return s}));var r=o("b775");function a(e){return Object(r["a"])({url:"pipeline/resource/".concat(e),method:"get"})}function i(e){return Object(r["a"])({url:"/pipeline/resource",method:"post",data:e})}function l(e,t){return Object(r["a"])({url:"/pipeline/resource/".concat(e),method:"put",data:t})}function s(e){return Object(r["a"])({url:"/pipeline/resource/".concat(e),method:"delete"})}},f7ec:function(e,t,o){"use strict";o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return i})),o.d(t,"d",(function(){return l})),o.d(t,"b",(function(){return s}));var r=o("b775");function a(){return Object(r["a"])({url:"/settings/secret",method:"get"})}function i(e){return Object(r["a"])({url:"/settings/secret",method:"post",data:e})}function l(e,t){return Object(r["a"])({url:"/settings/secret/".concat(e),method:"put",data:t})}function s(e){return Object(r["a"])({url:"/settings/secret/".concat(e),method:"delete"})}}}]);