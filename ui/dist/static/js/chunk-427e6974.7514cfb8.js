(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-427e6974"],{"120a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("clusterbar",{attrs:{titleName:e.titleName,nsFunc:e.projectId?void 0:e.nsSearch,nameFunc:e.nameSearch,createFunc:e.openCreateFormDialog}}),a("div",{staticClass:"dashboard-container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.secrets,"tooltip-effect":"dark","max-height":e.maxHeight,"cell-style":e.cellStyle,"default-sort":{prop:"name"},"row-key":"uid"}},[a("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"60","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" "+e._s(t.row.name)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"namespace",label:"命名空间","min-width":"40","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"type",label:"类型","min-width":"50","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"keys",label:"配置项","min-width":"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row.data,(function(t,s){return[a("el-tooltip",{key:s,staticClass:"item",attrs:{effect:"light",placement:"right-end"}},[a("div",{staticStyle:{"max-width":"400px","white-space":"pre-wrap"},attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(e.decodeBase(t))+" ")]),a("span",{staticClass:"back-class"},[e._v(" "+e._s(s)+" ")])])]}))]}}])}),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间","min-width":"45","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$dateFormat(t.row.create_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"操作","show-overflow-tooltip":"",width:"110px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"tableOperate"},[a("el-link",{staticClass:"operator-btn",attrs:{underline:!1},on:{click:function(a){return e.openUpdateFormDialog(t.row.namespace,t.row.name)}}},[e._v("编辑")]),a("el-link",{staticStyle:{color:"#F56C6C"},attrs:{underline:!1},on:{click:function(a){return e.handleDeleteSecret([{namespace:t.row.namespace,name:t.row.name}])}}},[e._v("删除")])],1)]}}])})],1)],1),a("el-dialog",{attrs:{title:e.updateFormVisible?"编辑Secret":"创建Secret",visible:e.createFormVisible,"destroy-on-close":!0,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){e.createFormVisible=t},close:e.closeFormDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[a("div",{staticClass:"dialogContent"},[a("el-form",{ref:"form",attrs:{model:e.secret.metadata,rules:e.rules,"label-position":"left","label-width":"105px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name",autofocus:"",required:""}},[a("el-input",{staticStyle:{width:"50%"},attrs:{autocomplete:"off",placeholder:"只能包含小写字母数字以及-和.,数字或者字母开头或结尾",size:"small",disabled:e.updateFormVisible},model:{value:e.secret.metadata.name,callback:function(t){e.$set(e.secret.metadata,"name",t)},expression:"secret.metadata.name"}})],1),a("el-form-item",{attrs:{label:"命名空间",prop:"description"}},[e.namespace?a("span",[e._v(e._s(e.namespace))]):a("el-select",{staticStyle:{width:"50%"},attrs:{disabled:e.updateFormVisible,placeholder:"请选择命名空间",size:"small"},model:{value:e.secret.metadata.namespace,callback:function(t){e.$set(e.secret.metadata,"namespace",t)},expression:"secret.metadata.namespace"}},e._l(e.namespaces,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"类型",prop:"name"}},[a("el-radio-group",{attrs:{size:"small"},model:{value:e.secret.type,callback:function(t){e.$set(e.secret,"type",t)},expression:"secret.type"}},[e.updateFormVisible?a("el-radio-button",{attrs:{label:e.secret.type}},[e._v(e._s(e.secret.type))]):[a("el-radio-button",{attrs:{label:"Opaque"}},[e._v("Opaque")]),a("el-radio-button",{attrs:{label:"kubernetes.io/tls"}},[e._v("TLS")]),a("el-radio-button",{attrs:{label:"kubernetes.io/basic-auth"}},[e._v("用户名/密码")]),a("el-radio-button",{attrs:{label:"kubernetes.io/dockerconfigjson"}},[e._v("镜像服务")])]],2)],1),"Opaque"==e.secret.type||-1==e.secretTypes.indexOf(e.secret.type)?a("el-form-item",{attrs:{label:"配置项",prop:"",required:!0}},[a("el-row",{staticStyle:{"margin-bottom":"5px","margin-top":"8px"}},[a("el-col",{staticStyle:{"background-color":"#F5F7FA","padding-left":"10px"},attrs:{span:11}},[a("div",{staticClass:"border-span-header"},[a("span",{staticClass:"border-span-content"},[e._v("*")]),e._v("Key ")])]),a("el-col",{staticStyle:{"background-color":"#F5F7FA"},attrs:{span:12}},[a("div",{staticClass:"border-span-header"},[e._v(" Value ")])])],1),e._l(e.secret.data,(function(t,s){return a("el-row",{key:s,staticStyle:{"padding-top":"0px"}},[a("el-col",{attrs:{span:11}},[a("div",{staticClass:"border-span-header"},[a("el-input",{staticStyle:{"padding-right":"10px"},attrs:{size:"small",placeholder:"配置项Key"},model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"d.key"}})],1)]),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"border-span-header"},[a("el-input",{staticStyle:{"border-radius":"0px","margin-bottom":"5px"},attrs:{type:"textarea",size:"small",placeholder:"配置项Value"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"d.value"}})],1)]),a("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:1}},[a("el-button",{staticStyle:{padding:"5px"},attrs:{circle:"",size:"mini",icon:"el-icon-close"},on:{click:function(t){return e.secret.data.splice(s,1)}}})],1)],1)})),a("el-row",[a("el-col",{attrs:{span:23}},[a("el-button",{staticStyle:{width:"100%","border-radius":"0px",padding:"9px 15px","border-color":"rgb(102, 177, 255)",color:"rgb(102, 177, 255)"},attrs:{plain:"",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.secret.data.push({})}}},[e._v("添加配置项")])],1)],1)],2):e._e(),"kubernetes.io/tls"==e.secret.type?a("el-form-item",{staticStyle:{width:"60%"},attrs:{label:"证书",required:""}},[a("el-input",{attrs:{type:"textarea",placeholder:"",size:"small"},model:{value:e.secret.tls.crt,callback:function(t){e.$set(e.secret.tls,"crt",t)},expression:"secret.tls.crt"}})],1):e._e(),"kubernetes.io/tls"==e.secret.type?a("el-form-item",{staticStyle:{width:"60%"},attrs:{label:"密钥",required:""}},[a("el-input",{attrs:{type:"textarea",placeholder:"",size:"small"},model:{value:e.secret.tls.key,callback:function(t){e.$set(e.secret.tls,"key",t)},expression:"secret.tls.key"}})],1):e._e(),"kubernetes.io/basic-auth"==e.secret.type?a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"用户",required:""}},[a("el-input",{attrs:{placeholder:"",size:"small"},model:{value:e.secret.userPass.username,callback:function(t){e.$set(e.secret.userPass,"username",t)},expression:"secret.userPass.username"}})],1):e._e(),"kubernetes.io/basic-auth"==e.secret.type?a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"密码",required:""}},[a("el-input",{attrs:{type:"password",autocomplete:"new-password",placeholder:"",size:"small"},model:{value:e.secret.userPass.password,callback:function(t){e.$set(e.secret.userPass,"password",t)},expression:"secret.userPass.password"}})],1):e._e(),"kubernetes.io/dockerconfigjson"==e.secret.type?a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"仓库地址",required:""}},[a("el-input",{attrs:{placeholder:"镜像仓库地址",size:"small"},model:{value:e.secret.imagePass.url,callback:function(t){e.$set(e.secret.imagePass,"url",t)},expression:"secret.imagePass.url"}})],1):e._e(),"kubernetes.io/dockerconfigjson"==e.secret.type?a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"用户",required:""}},[a("el-input",{attrs:{placeholder:"镜像仓库认证用户",size:"small"},model:{value:e.secret.imagePass.username,callback:function(t){e.$set(e.secret.imagePass,"username",t)},expression:"secret.imagePass.username"}})],1):e._e(),"kubernetes.io/dockerconfigjson"==e.secret.type?a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"密码",required:""}},[a("el-input",{attrs:{type:"password",autocomplete:"new-password",placeholder:"镜像仓库认证密码",size:"small"},model:{value:e.secret.imagePass.password,callback:function(t){e.$set(e.secret.imagePass,"password",t)},expression:"secret.imagePass.password"}})],1):e._e(),"kubernetes.io/dockerconfigjson"==e.secret.type?a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"邮箱",required:""}},[a("el-input",{attrs:{placeholder:"用户邮箱",size:"small"},model:{value:e.secret.imagePass.email,callback:function(t){e.$set(e.secret.imagePass,"email",t)},expression:"secret.imagePass.email"}})],1):e._e()],1)],1),a("div",{staticClass:"dialogFooter",staticStyle:{"margin-top":"25px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{"margin-right":"20px"},on:{click:function(t){e.createFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updateFormVisible?e.handleUpdateSecret():e.handleCreateSecret()}}},[e._v("确 定")])],1)])])],1)},r=[],i=(a("99af"),a("caad"),a("c975"),a("b0c0"),a("2532"),a("b85c")),l=a("61b2"),c=a("5c96"),n=a("8b96"),o=a("7ea2"),d=a("4fee"),u=a("aad4"),p=a("651e"),m=a.n(p),h={name:"Secrets",components:{Clusterbar:l["a"]},data:function(){return{titleName:["Secrets"],originSecrets:[],search_name:"",search_ns:[],cellStyle:{border:0},maxHeight:window.innerHeight-135,loading:!0,dialogLoading:!1,createFormVisible:!1,updateFormVisible:!1,secretTypes:["Opaque","kubernetes.io/tls","kubernetes.io/basic-auth","kubernetes.io/dockerconfigjson"],secret:{apiVersion:"v1",kind:"Secret",metadata:{name:""},data:[],type:"Opaque",tls:{},userPass:{},imagePass:{}},rules:{},namespaces:[]}},created:function(){this.fetchData()},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-135;e.maxHeight=t}()}},watch:{cluster:function(){this.fetchData()}},computed:{secrets:function(){var e,t=[],a=Object(i["a"])(this.originSecrets);try{for(a.s();!(e=a.n()).done;){var s=e.value;this.search_ns.length>0&&this.search_ns.indexOf(s.namespace)<0||(this.search_name&&!s.name.includes(this.search_name)||t.push(s))}}catch(r){a.e(r)}finally{a.f()}return t},projectId:function(){return this.$route.params.workspaceId},cluster:function(){return this.$store.state.cluster},namespace:function(){return this.$store.state.namespace}},methods:{decodeBase:function(e){try{return atob(e)}catch(t){return e}},nameClick:function(e,t){console.log(e,t),this.$router.push({name:"secretDetail",params:{namespace:e,secretName:t}})},nsSearch:function(e){this.search_ns=[];var t,a=Object(i["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;this.search_ns.push(s)}}catch(r){a.e(r)}finally{a.f()}},nameSearch:function(e){this.search_name=e},fetchData:function(){var e=this;this.loading=!0;var t=this.$store.state.cluster,a={namespace:this.namespace};this.projectId&&(a["labels"]=Object(d["c"])()),t?Object(n["c"])(t,a).then((function(t){e.loading=!1;var a=t.data||[];e.$set(e,"originSecrets",a)})).catch((function(){e.loading=!1})):this.projectId||(this.loading=!1,c["Message"].error("获取集群异常，请刷新重试"))},handleCreateSecret:function(){var e=this,t=JSON.parse(JSON.stringify(this.secret));if(t.metadata.name){var a=Object(n["e"])(t);if(a)c["Message"].error(a);else if(this.namespace&&(t.metadata.namespace=this.namespace),t.metadata.namespace){this.projectId&&(t.metadata.labels=Object(d["c"])());var s=m.a.dump(t);this.dialogLoading=!0,Object(o["e"])(this.cluster,s).then((function(t){e.dialogLoading=!1,e.createFormVisible=!1,c["Message"].success("创建Secret成功"),e.fetchData()})).catch((function(){e.dialogLoading=!1}))}else c["Message"].error("命名空间不能为空")}else c["Message"].error("请输入名称")},handleUpdateSecret:function(){var e=this,t=JSON.parse(JSON.stringify(this.secret)),a=Object(n["e"])(t);if(a)c["Message"].error(a);else{var s=m.a.dump(t);this.dialogLoading=!0,Object(n["f"])(this.cluster,this.secret.metadata.namespace,this.secret.metadata.name,s).then((function(t){e.dialogLoading=!1,e.createFormVisible=!1,c["Message"].success("编辑Secret成功"),e.fetchData()})).catch((function(){e.dialogLoading=!1}))}},handleDeleteSecret:function(e){var t,a=this,s="",r=Object(i["a"])(e);try{for(r.s();!(t=r.n()).done;){var l=t.value;s+="".concat(l.namespace,"/").concat(l.name,",")}}catch(o){r.e(o)}finally{r.f()}s=s.substr(0,s.length-1),this.$confirm("请确认是否删除「".concat(s,"」Secret?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.loading=!0,Object(n["a"])(a.cluster,{resources:e}).then((function(){c["Message"].success("删除Secret成功"),a.loading=!1,a.fetchData()})).catch((function(e){a.loading=!1}))})).catch((function(){}))},getSecret:function(e,t){var a=this,s=this.$store.state.cluster;s?e?t?(this.dialogLoading=!0,Object(n["b"])(s,e,t).then((function(e){a.dialogLoading=!1;var t=e.data;Object(n["d"])(t),a.secret=t})).catch((function(){a.dialogLoading=!1}))):c["Message"].error("获取Secret名称参数异常，请刷新重试"):c["Message"].error("获取命名空间参数异常，请刷新重试"):c["Message"].error("获取集群参数异常，请刷新重试")},fetchNamespace:function(){var e=this;this.namespaces=[];var t=this.$store.state.cluster;t?Object(u["b"])(t).then((function(t){e.namespaces=t.data,e.namespaces.sort((function(e,t){return e.name>t.name?1:-1}))})).catch((function(e){console.log(e)})):c["Message"].error("获取集群异常，请刷新重试")},openCreateFormDialog:function(){this.namespace||0!=this.namespaces.length||this.fetchNamespace(),this.createFormVisible=!0},openUpdateFormDialog:function(e,t){this.createFormVisible=!0,this.updateFormVisible=!0,this.namespace||0!=this.namespaces.length||this.fetchNamespace(),this.getSecret(e,t)},closeFormDialog:function(){this.createFormVisible=!1,this.updateFormVisible=!1,this.secret={apiVersion:"v1",kind:"Secret",metadata:{name:""},data:[],type:"Opaque",tls:{},userPass:{},imagePass:{}}}}},f=h,b=(a("3cc8"),a("2877")),g=Object(b["a"])(f,s,r,!1,null,"9bc6ba1e",null);t["default"]=g.exports},"3cc8":function(e,t,a){"use strict";var s=a("a786"),r=a.n(s);r.a},a786:function(e,t,a){}}]);