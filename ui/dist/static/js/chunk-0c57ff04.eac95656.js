(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c57ff04"],{"0fdd":function(e,a,t){"use strict";t.r(a);var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("clusterbar",{attrs:{titleName:e.titleName,nsFunc:e.projectId?void 0:e.nsSearch,nameFunc:e.nameSearch,createFunc:e.openCreateFormDialog}}),t("div",{staticClass:"dashboard-container"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.configMaps,"tooltip-effect":"dark","max-height":e.maxHeight,"cell-style":e.cellStyle,"default-sort":{prop:"name"}}},[t("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"60","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(a.row.name)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"namespace",label:"命名空间","min-width":"40","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"keys",label:"配置项","min-width":"90","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[e._l(a.row.data,(function(a,n){return[t("el-tooltip",{key:n,staticClass:"item",attrs:{effect:"light",placement:"right-end"}},[t("div",{staticStyle:{"max-width":"400px","white-space":"pre-wrap"},attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(a)+" ")]),t("span",{staticClass:"back-class"},[e._v(" "+e._s(n)+" ")])])]}))]}}])}),t("el-table-column",{attrs:{prop:"create_time",label:"创建时间","min-width":"45","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v(" "+e._s(e.$dateFormat(a.row.create_time))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作","show-overflow-tooltip":"",width:"110px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"tableOperate"},[t("el-link",{staticStyle:{"margin-right":"15px"},attrs:{disabled:!e.$editorRole(),underline:!1,type:"primary"},on:{click:function(t){return e.openUpdateFormDialog(a.row.namespace,a.row.name)}}},[e._v("编辑")]),t("el-link",{attrs:{disabled:!e.$editorRole(),underline:!1,type:"danger"},on:{click:function(t){return e.handleDeleteConfigMap([{namespace:a.row.namespace,name:a.row.name}])}}},[e._v("删除")])],1)]}}])})],1)],1),t("el-dialog",{attrs:{title:e.updateFormVisible?"编辑ConfigMap":"创建ConfigMap",visible:e.createFormVisible,"destroy-on-close":!0,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(a){e.createFormVisible=a},close:e.closeFormDialog}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[t("div",{staticClass:"dialogContent",staticStyle:{margin:"0px"}},[t("el-form",{ref:"form",attrs:{model:e.configMap.metadata,rules:e.rules,"label-position":"left","label-width":"105px"}},[t("el-form-item",{attrs:{label:"名称",prop:"name",autofocus:"",required:""}},[t("el-input",{staticStyle:{width:"50%"},attrs:{autocomplete:"off",placeholder:"只能包含小写字母数字以及-和.,数字或者字母开头或结尾",size:"small",disabled:e.updateFormVisible},model:{value:e.configMap.metadata.name,callback:function(a){e.$set(e.configMap.metadata,"name",a)},expression:"configMap.metadata.name"}})],1),t("el-form-item",{attrs:{label:"命名空间",prop:"description"}},[e.namespace?t("span",[e._v(e._s(e.namespace))]):t("el-select",{staticStyle:{width:"50%"},attrs:{disabled:e.updateFormVisible,placeholder:"请选择命名空间",size:"small"},model:{value:e.configMap.metadata.namespace,callback:function(a){e.$set(e.configMap.metadata,"namespace",a)},expression:"configMap.metadata.namespace"}},e._l(e.namespaces,(function(e){return t("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"配置项",prop:"",required:!0}},[t("el-row",{staticStyle:{"margin-bottom":"5px","margin-top":"8px"}},[t("el-col",{staticStyle:{"background-color":"#F5F7FA","padding-left":"10px"},attrs:{span:11}},[t("div",{staticClass:"border-span-header"},[t("span",{staticClass:"border-span-content"},[e._v("*")]),e._v("Key ")])]),t("el-col",{staticStyle:{"background-color":"#F5F7FA"},attrs:{span:12}},[t("div",{staticClass:"border-span-header"},[e._v(" Value ")])])],1),e._l(e.configMap.data,(function(a,n){return t("el-row",{key:n,staticStyle:{"padding-top":"0px"}},[t("el-col",{attrs:{span:11}},[t("div",{staticClass:"border-span-header"},[t("el-input",{staticStyle:{"padding-right":"10px"},attrs:{size:"small",placeholder:"配置项Key"},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"d.key"}})],1)]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"border-span-header"},[t("el-input",{staticStyle:{"border-radius":"0px","margin-bottom":"5px"},attrs:{type:"textarea",size:"small",placeholder:"配置项Value"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"d.value"}})],1)]),t("el-col",{staticStyle:{"padding-left":"10px"},attrs:{span:1}},[t("el-button",{staticStyle:{padding:"5px"},attrs:{circle:"",size:"mini",icon:"el-icon-close"},on:{click:function(a){return e.configMap.data.splice(n,1)}}})],1)],1)})),t("el-row",[t("el-col",{attrs:{span:23}},[t("el-button",{staticStyle:{width:"100%","border-radius":"0px",padding:"9px 15px","border-color":"rgb(102, 177, 255)",color:"rgb(102, 177, 255)"},attrs:{plain:"",size:"mini",icon:"el-icon-plus"},on:{click:function(a){return e.configMap.data.push({})}}},[e._v("添加配置项")])],1)],1)],2)],1)],1),t("div",{staticClass:"dialogFooter",staticStyle:{"margin-top":"25px"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticStyle:{"margin-right":"20px"},on:{click:function(a){e.createFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.updateFormVisible?e.handleUpdateConfigMap():e.handleCreateConfigMap()}}},[e._v("确 定")])],1)])])],1)},i=[],s=(t("99af"),t("caad"),t("c975"),t("b0c0"),t("d3b7"),t("2532"),t("ddb0"),t("b85c")),o=t("61b2"),r=t("5c96"),c=t("6095"),l=t("7ea2"),d=t("4fee"),p=t("aad4"),u=t("e2c1"),f={name:"ConfigMap",components:{Clusterbar:o["a"]},data:function(){return{titleName:["ConfigMap"],originConfigMaps:[],search_name:"",search_ns:[],cellStyle:{border:0},maxHeight:window.innerHeight-135,loading:!0,dialogLoading:!1,createFormVisible:!1,updateFormVisible:!1,configMap:{apiVersion:"v1",kind:"ConfigMap",metadata:{name:""},data:[]},rules:{},namespaces:[]}},mounted:function(){var e=this;window.onresize=function(){return function(){var a=window.innerHeight-135;e.maxHeight=a}()}},created:function(){this.fetchData()},watch:{cluster:function(){this.fetchData()}},computed:{configMaps:function(){var e,a=[],t=Object(s["a"])(this.originConfigMaps);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!(this.search_ns.length>0&&this.search_ns.indexOf(n.namespace)<0)&&(!this.search_name||n.name.includes(this.search_name))){var i,o="",r=Object(s["a"])(n.keys);try{for(r.s();!(i=r.n()).done;){var c=i.value;o+=c+","}}catch(l){r.e(l)}finally{r.f()}o.length>0&&(o=o.substr(0,o.length-1)),a.push(n)}}}catch(l){t.e(l)}finally{t.f()}return a},projectId:function(){return this.$route.params.workspaceId},cluster:function(){return this.$store.state.cluster},namespace:function(){return this.$store.state.namespace}},methods:{nameClick:function(e,a){this.$router.push({name:"configMapDetail",params:{namespace:e,configMapName:a}})},nsSearch:function(e){this.search_ns=[];var a,t=Object(s["a"])(e);try{for(t.s();!(a=t.n()).done;){var n=a.value;this.search_ns.push(n)}}catch(i){t.e(i)}finally{t.f()}},nameSearch:function(e){this.search_name=e},fetchData:function(){var e=this;this.loading=!0;var a=this.$store.state.cluster,t={namespace:this.namespace};this.projectId&&(t["labels"]=Object(d["e"])()),a?Object(c["c"])(a,t).then((function(a){e.loading=!1;var t=a.data||[];e.$set(e,"originConfigMaps",t)})).catch((function(){e.loading=!1})):this.projectId||(this.loading=!1,r["Message"].error("获取集群异常，请刷新重试"))},handleCreateConfigMap:function(){var e=this,a=JSON.parse(JSON.stringify(this.configMap));if(a.metadata.name)if(0!=a.data.length){var t,n={},i=Object(s["a"])(a.data);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(!o.key)return void r["Message"].error("配置项Key不能为空");n[o.key]=o.value||""}}catch(p){i.e(p)}finally{i.f()}if(a.data=n,this.namespace&&(a.metadata.namespace=this.namespace),a.metadata.namespace){this.projectId&&(a.metadata.labels=Object(d["e"])());var c=u["default"].dump(a);this.dialogLoading=!0,Object(l["e"])(this.cluster,c).then((function(a){e.dialogLoading=!1,e.createFormVisible=!1,r["Message"].success("创建ConfigMap成功"),e.fetchData()})).catch((function(){e.dialogLoading=!1}))}else r["Message"].error("命名空间不能为空")}else r["Message"].error("请添加配置项");else r["Message"].error("请输入名称")},handleUpdateConfigMap:function(){var e,a=this,t=JSON.parse(JSON.stringify(this.configMap)),n={},i=Object(s["a"])(t.data);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(!o.key)return void r["Message"].error("配置项Key不能为空");n[o.key]=o.value||""}}catch(d){i.e(d)}finally{i.f()}t.data=n;var l=u["default"].dump(t);this.dialogLoading=!0,Object(c["d"])(this.cluster,t.metadata.namespace,t.metadata.name,l).then((function(e){a.dialogLoading=!1,a.createFormVisible=!1,r["Message"].success("编辑ConfigMap成功"),a.fetchData()})).catch((function(){a.dialogLoading=!1}))},handleDeleteConfigMap:function(e){var a,t=this,n="",i=Object(s["a"])(e);try{for(i.s();!(a=i.n()).done;){var o=a.value;n+="".concat(o.namespace,"/").concat(o.name,",")}}catch(l){i.e(l)}finally{i.f()}n=n.substr(0,n.length-1),this.$confirm("请确认是否删除「".concat(n,"」ConfigMap?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(c["a"])(t.cluster,{resources:e}).then((function(){r["Message"].success("删除ConfigMap成功"),t.loading=!1,t.fetchData()})).catch((function(e){t.loading=!1}))})).catch((function(){}))},getConfigMap:function(e,a){var t=this,n=this.$store.state.cluster;n?e?a?(this.dialogLoading=!0,Object(c["b"])(n,e,a).then((function(e){t.dialogLoading=!1,t.configMap=e.data;var a=[];for(var n in t.configMap.data)a.push({key:n,value:t.configMap.data[n]});t.configMap.data=a})).catch((function(){t.dialogLoading=!1}))):r["Message"].error("获取ConfigMap名称参数异常，请刷新重试"):r["Message"].error("获取命名空间参数异常，请刷新重试"):r["Message"].error("获取集群参数异常，请刷新重试")},fetchNamespace:function(){var e=this;this.namespaces=[];var a=this.$store.state.cluster;a?Object(p["b"])(a).then((function(a){e.namespaces=a.data,e.namespaces.sort((function(e,a){return e.name>a.name?1:-1}))})).catch((function(e){console.log(e)})):r["Message"].error("获取集群异常，请刷新重试")},openCreateFormDialog:function(){0!=this.namespaces.length||this.namespace||this.fetchNamespace(),this.configMap={apiVersion:"v1",kind:"ConfigMap",metadata:{name:""},data:[]},this.createFormVisible=!0},openUpdateFormDialog:function(e,a){this.createFormVisible=!0,this.updateFormVisible=!0,0!=this.namespaces.length||this.namespace||this.fetchNamespace(),this.getConfigMap(e,a)},closeFormDialog:function(){this.createFormVisible=!1,this.updateFormVisible=!1}}},m=f,h=(t("fd2d"),t("2877")),g=Object(h["a"])(m,n,i,!1,null,"8afaea22",null);a["default"]=g.exports},ba51:function(e,a,t){},fd2d:function(e,a,t){"use strict";var n=t("ba51"),i=t.n(n);i.a}}]);